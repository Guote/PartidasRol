Application.prototype._recalculateDimensions=function(){this.element[0].style.height="",this.setPosition({});};class SettingsProcessor{_updateLabels(text,div,percentage){var[label,hint]=text.split(SettingsProcessor.DELIM);if(void 0!==percentage){isNaN(percentage)&&(percentage=0);const[redPerc,greenPerc]=percentage<=.5?[percentage/.5,1]:[1,1-(percentage-.5)/.5],red=Math.round(255*redPerc).toString(16).padStart(2,"0"),green=Math.round(255*greenPerc).toString(16).padStart(2,"0");div.css("border-left",`thick solid #${red}${green}00`),div.css("padding-left","6px");}else div.css("border-left",""),div.css("padding-left","");div.find(">label").html(label),div[0].classList.contains("submenu")?div.find("button>label").html(hint):div.find(".notes").html(hint);}_getOptions(query){return {keys:["text"],limit:1/0,threshold:-Math.min(1e5,1e4+1e4*(query.length-2)),allowTypo:!1}}}SettingsProcessor.DELIM=" `````` ";class DefaultSettingsProcessor extends SettingsProcessor{constructor(){super(...arguments),this._settings=[];}_getMenuData(div){return {el:div,text:$(div).find(">label").text()+SettingsProcessor.DELIM+$(div).find("button").find("label").text()}}_getRegularData(div){return {el:div,text:$(div).find(">label").text()+SettingsProcessor.DELIM+$(div).find(".notes").text()}}processSettings(html){$(html.find(".settings-list")[2]).children().each((idx,element)=>{element instanceof HTMLHeadingElement||(element.classList.contains("submenu")?this._settings.push(this._getMenuData($(element))):this._settings.push(this._getRegularData($(element))));});}injectSearch(html){const search=$(`\n<div id="dfsc_search" class="searchBox">\n\t<input type="text" placeholder="${game.i18n.localize("DF_SETTINGS_CLARITY.SearchPlaceholder")}">\n\t<button class="dfsc_clear-search" style="display:none"><i class="fas fa-times"></i></button>\n</div>`);return $(html.find(".settings-list")[2]).prepend(search),html.find('button[name="reset"]').css("height","fit-content"),html.find('button[name="reset"]').css("margin-top","auto"),html.find('button[name="submit"]').css("height","fit-content"),html.find('button[name="submit"]').css("margin-top","auto"),search}performSearch(pattern){if(pattern.length<2){for(let item of this._settings)item.el.show(),this._updateLabels(item.text,item.el);return}const results=fuzzysort.go(pattern,this._settings,this._getOptions(pattern));for(let c=0;c<this._settings.length;c++){const resultIdx=results.findIndex(x=>x.obj===this._settings[c]);var text,percentage=void 0;resultIdx>=0?(this._settings[c].el.show(),text=fuzzysort.highlight(results[resultIdx][0]),percentage=resultIdx/(results.length-1)):(this._settings[c].el.hide(),text=this._settings[c].text),this._updateLabels(text,this._settings[c].el,percentage);}}}class TidyUiSettingsProcessor extends SettingsProcessor{constructor(){super(...arguments),this._settings=[],this._articles=new Map;}_toggleArticle(article,open){open?(article.find("h2").addClass("open"),article.find("section").show()):(article.find("h2").removeClass("open"),article.find("section").hide());}_getMenuData(article,div){return {article:article,el:div,text:$(div).find(">label").text()+SettingsProcessor.DELIM+$(div).find("button>label").text()}}_getRegularData(article,div){return {article:article,el:div,text:$(div).find(">label").text()+SettingsProcessor.DELIM+$(div).find(".notes").text()}}processSettings(html){html.find(".settings-list > article").each((_,element)=>{this._articles.set(element,!1),$(element).find("section").children().each((_,childElement)=>{const child=$(childElement);childElement.classList.contains("submenu")?this._settings.push(this._getMenuData(element,child)):this._settings.push(this._getRegularData(element,child));});});}injectSearch(html){const search=$(`\n<div id="dfsc_search" class="searchBox tidy-ui">\n\t<input type="text" placeholder="${game.i18n.localize("DF_SETTINGS_CLARITY.SearchPlaceholder")}">\n\t<button class="dfsc_clear-search" style="display:none"><i class="fas fa-times"></i></button>\n</div>`);return html.find("#searchField").after(search),html.find("#config-tabs .settings-list")[2].style.maxHeight="calc(100vh - 227px)",search}performSearch(pattern){if(pattern.length<2){for(let item of this._settings)item.el.show(),super._updateLabels(item.text,item.el);for(let article of this._articles.entries())this._articles.set(article[0],!1),this._toggleArticle($(article[0]),!1);return}const results=fuzzysort.go(pattern,this._settings,this._getOptions(pattern));for(let article of this._articles.keys())this._articles.set(article,!1);for(let c=0;c<this._settings.length;c++){const resultIdx=results.findIndex(x=>x.obj===this._settings[c]);var text,percentage=void 0;resultIdx>=0?(this._articles.set(this._settings[c].article,!0),this._settings[c].el.show(),text=fuzzysort.highlight(results[resultIdx][0]),percentage=resultIdx/(results.length-1)):(this._settings[c].el.hide(),text=this._settings[c].text),this._updateLabels(text,this._settings[c].el,percentage);}for(let article of this._articles.entries())this._toggleArticle($(article[0]),article[1]);}}class FuzzySearch{static init(){Hooks.on("renderSettingsConfig",(_settingsConfig,html,_data)=>{var _a;(null===(_a=game.modules.get("tidy-ui_game-settings"))||void 0===_a?void 0:_a.active)?this._settingsProcessor=new TidyUiSettingsProcessor:this._settingsProcessor=new DefaultSettingsProcessor,this._settingsProcessor.processSettings(html);const searchField=this._settingsProcessor.injectSearch(html);searchField.find("input").on("input",function(){const value=$(this).val();FuzzySearch._settingsProcessor.performSearch(value),""===value?searchField.find("button").hide():searchField.find("button").show();}),searchField.find("button").on("click",function(event){event.preventDefault(),searchField.find("input").val(""),$(this).hide(),FuzzySearch._settingsProcessor.performSearch("");}),_settingsConfig._recalculateDimensions();});}}FuzzySearch._settingsProcessor=null;

class DFSettingsClarity{static patchGameSettings(){var _a;for(var pair of(libWrapper.register("df-settings-clarity","ClientSettings.prototype.register",DFSettingsClarity.settingsRegister,"WRAPPER"),game.settings.settings))pair[1].name=DFSettingsClarity.formatName(null!==(_a=pair[1].name)&&void 0!==_a?_a:"",pair[1]);}static patchGameSettingsMenus(){var _a;for(var pair of(libWrapper.register("df-settings-clarity","ClientSettings.prototype.registerMenu",DFSettingsClarity.settingsRegisterMenu,"WRAPPER"),game.settings.menus))pair[1].name=DFSettingsClarity.formatName(null!==(_a=pair[1].name)&&void 0!==_a?_a:"",pair[1]);}static formatName(name,data){return name.startsWith("ðŸ‘¤")||name.startsWith("ðŸŒŽ")?name:(data.scope?scope=DFSettingsClarity.types.includes(data.scope)?data.scope:"client":data.restricted?scope=data?"world":"client":(console.warn("Unknown restriction/scope on registered setting for "+name+'". Defaulting to "client"'),scope="client"),"client"===scope?name?"ðŸ‘¤ "+game.i18n.localize(name):"ðŸ‘¤":"world"===scope?name?"ðŸŒŽ "+game.i18n.localize(name):"ðŸŒŽ":name);var scope;}static settingsRegister(wrapper,module,key,data){var _a;data.name=DFSettingsClarity.formatName(null!==(_a=data.name)&&void 0!==_a?_a:"",data),wrapper(module,key,data);}static settingsRegisterMenu(wrapper,module,key,data){var _a;data.name=DFSettingsClarity.formatName(null!==(_a=data.name)&&void 0!==_a?_a:"",data),wrapper(module,key,data);}static showWorldHover(event){event.clientX>$(event.target).offset().left+30?DFSettingsClarity.hideHover():DFSettingsClarity.showHover($(event.target),"world");}static showClientHover(event){event.clientX>$(event.target).offset().left+30?DFSettingsClarity.hideHover():DFSettingsClarity.showHover($(event.target),"client");}static showHover(element,scope){const hover=DFSettingsClarity.hover;if(0!=hover.parent().length)return;hover.find("span.msg").text(game.i18n.localize("DF_SETTINGS_CLARITY.Scope_"+scope)),$(document.body).append(hover);const css={position:"absolute",left:`${element.offset().left-hover.outerWidth()}px`,top:`${element.offset().top-15}px`};hover.css(css);}static hideHover(){0!=DFSettingsClarity.hover.parent().length&&DFSettingsClarity.hover.remove();}}DFSettingsClarity.types=["client","world"],DFSettingsClarity.hover=$('<div class="df-settings-clarity-tooltip" style="visibility:hidden"><span class="msg"></span><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMzAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtMCAwLjVhMTEuNDA4IDExLjQwOCAyNC4wNTcgMCAxIDcuNjUxNCAzLjQxNThsMTEuODQ5IDExLjA4NC0xMS44NDkgMTEuMDg0YTExLjQwOCAxMS40MDggMTU1Ljk0IDAgMS03LjY1MTQgMy40MTU4IiBmaWxsPSIjMDAwMDAwQmYiIHN0cm9rZT0iI2Y2MCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg=="></div>'),Hooks.once("init",function(){FuzzySearch.init();}),Hooks.once("setup",function(){var user=game.data.users.find(x=>x._id===game.userId);const perms=game.settings.get("core","permissions");user&&perms.SETTINGS_MODIFY.includes(user.role)&&(DFSettingsClarity.patchGameSettings(),DFSettingsClarity.patchGameSettingsMenus()),$(document.body).append(DFSettingsClarity.hover);}),Hooks.once("ready",function(){var _a;if(!(null===(_a=game.modules.get("lib-wrapper"))||void 0===_a?void 0:_a.active))return console.error("Missing libWrapper module dependency"),void(game.user.isGM&&ui.notifications.error(game.i18n.localize("DF_SETTINGS_CLARITY.errorLibWrapperMissing")));DFSettingsClarity.hover.remove(),DFSettingsClarity.hover.attr("style","");}),Hooks.on("renderSettingsConfig",function(settingsConfig,html,data){const world=html.find("label:contains('ðŸŒŽ')");world.mousemove(DFSettingsClarity.showWorldHover),world.mouseleave(DFSettingsClarity.hideHover);const client=html.find("label:contains('ðŸ‘¤')");client.mousemove(DFSettingsClarity.showClientHover),client.mouseleave(DFSettingsClarity.hideHover);});
