{
  "version": 3,
  "sources": ["../src/config.mjs", "../src/data-types.mjs", "../src/data-editor.mjs", "../src/data-structure.mjs", "../src/data/search-result.mjs", "../src/data/term-match.mjs", "../src/data/score.mjs", "../src/data-browser.mjs", "../src/settings.mjs", "../src/initialize.mjs"],
  "sourcesContent": [
    "export const CFG = {\n\tid: 'data-inspector',\n\tSETTINGS: {\n\t\tallowEditing: 'allowEditing',\n\t\tallowEditingUnsupported: 'allowEditingUnsupported',\n\t\tallowUsers: 'allowUsers',\n\t\tfunctions: 'functions',\n\t\tresults: 'results',\n\t\tmode: 'mode',\n\t\ttooltip: 'tooltip',\n\t},\n\tCOLORS: {\n\t\tmain: 'color:deepskyblue',\n\t\tnumber: 'color:mediumpurple',\n\t\tlabel: 'color:mediumseagreen',\n\t\tid: 'color:darkseagreen',\n\t\tunset: 'color:unset',\n\t},\n\ttypeIcons: {\n\t\tarray: 'fa-solid fa-list-ol', //\n\t\tnumber: 'fa-solid fa-hashtag', // ðŸ”¢\n\t\tstring: '', // ðŸ”¤\n\t\tobject: 'fa-solid fa-box', // ðŸ“¦\n\t\tmodel: 'fa-solid fa-pizza-slice', // ðŸ•\n\n\t},\n};\n",
    "/**\n * Recognized data types\n *\n * @readonly\n * @enum {number}\n */\nexport const DATA_TYPES = {\n\tundefined: -1,\n\tnull: 0,\n\tobject: 110,\n\tnumber: 410,\n\tboolean: 420,\n\tstring: 430,\n\tarray: 120,\n\tset: 130,\n\tmap: 510,\n\tcollection: 520,\n\tfunction: 910,\n\tgetter: 980,\n\tmodel: 1010,\n\t// data: 2010,\n\tdocument: 2020,\n\tplaceable: 5010,\n\tpixi: 5020,\n\tapp: 5030,\n\tcustom: 10000,\n};\n\n/**\n * @readonly\n * @enum {string}\n */\nexport const DATA_TYPE_INVERTED = foundry.utils.invertObject(DATA_TYPES);\n\n/**\n * Better type name getter.\n *\n * @param value\n * @returns {string}\n */\nexport const getTypeName = (value) => {\n\tif (value === undefined) return 'undefined';\n\tif (value === null) return 'null';\n\tconst type = typeof value;\n\tif (['string', 'number', 'function', 'boolean'].includes(type)) return type;\n\tif (Array.isArray(value)) return 'array';\n\t// Gets class name more reliably than just value.contructor.name\n\tconst n = value.__proto__.constructor.name;\n\tif (n === 'Object') return 'object';\n\tif (n === 'Map') return 'map';\n\treturn '_' + n; // underscore to ensure they don't conflict with the other names under any circumstances\n};\n\nexport const getModelType = (model) => {\n\tconst fields = foundry.data.fields;\n\tif (model instanceof fields.BooleanField)\n\t\treturn DATA_TYPES.boolean;\n\telse if (model instanceof fields.StringField)\n\t\treturn DATA_TYPES.string;\n\telse if (model instanceof fields.NumberField)\n\t\treturn DATA_TYPES.number;\n\telse if (model instanceof fields.ArrayField)\n\t\treturn DATA_TYPES.array;\n\telse if (model instanceof fields.ObjectField)\n\t\treturn DATA_TYPES.object;\n\telse if (model instanceof fields.SchemaField)\n\t\treturn DATA_TYPES.model;\n\telse if (model instanceof fields.EmbeddedDataField)\n\t\treturn DATA_TYPES.model;\n\n\treturn DATA_TYPES.custom;\n};\n\n/**\n * @param {any} parent - Parent object\n * @param {string} childKey - Child key\n * @returns {DATA_TYPES} - Data type\n */\nexport function getChildTypeId(parent, childKey) {\n\tconst data = Object.getOwnPropertyDescriptor(parent, childKey);\n\tif (typeof data.get === 'function') return DATA_TYPES.getter;\n\treturn getTypeId(parent[childKey]);\n}\n\n/**\n * @param {any} value - Data\n * @returns {DATA_TYPES} - Data type\n */\nexport function getTypeId(value) {\n\tif (value === undefined) return DATA_TYPES.undefined;\n\tif (value === null) return DATA_TYPES.null;\n\tconst type = typeof value;\n\tswitch (type) {\n\t\tcase 'string':\n\t\t\treturn DATA_TYPES.string;\n\t\tcase 'number':\n\t\tcase 'bigint':\n\t\t\treturn DATA_TYPES.number;\n\t\tcase 'function':\n\t\t\treturn DATA_TYPES.function;\n\t\tcase 'boolean':\n\t\t\treturn DATA_TYPES.boolean;\n\t}\n\tif (Array.isArray(value)) return DATA_TYPES.array;\n\tif (value instanceof Set) return DATA_TYPES.set;\n\tif (value instanceof foundry.abstract.Document) return DATA_TYPES.document;\n\t// Prevent placeables, pixi elements and applications\n\tif (value instanceof PlaceableObject) return DATA_TYPES.placeable;\n\tif (value instanceof PIXI.Container) return DATA_TYPES.pixi;\n\tif (value instanceof Application) return DATA_TYPES.app;\n\tif (value instanceof foundry.abstract.DataModel) return DATA_TYPES.model;\n\t// Gets class name more reliably than just value.contructor.name\n\tif (value instanceof Collection) return DATA_TYPES.collection;\n\tif (value instanceof Map) return DATA_TYPES.map;\n\tconst n = value.__proto__?.constructor.name;\n\tif (n === 'Object') return DATA_TYPES.object;\n\treturn DATA_TYPES.custom;\n}\n",
    "import { CFG } from './config.mjs';\nimport { getTypeName, getTypeId, DATA_TYPES, DATA_TYPE_INVERTED } from './data-types.mjs';\n\nconst fu = foundry.utils;\n\n/**\n *\n * @param {object} update Update prop\n * @param {object} parent Parent prop data\n * @param {object} options\n * @param {boolean} options.isDelete Is this a delete operation?\n * @param {boolean} options.inArray\n * @param options.isUpdate\n */\nconst setUpdateData = (update, parent, { inArray = false, isUpdate = false, isDelete = false } = {}) => {\n\tconst opLabel = isDelete ? 'Delete' : 'Update';\n\n\tconst { value, last: updateProp } = update;\n\n\t// Update or delete array index\n\tconst C = CFG.COLORS;\n\tif (Array.isArray(updateProp)) {\n\t\tconst index = Number(parent.child);\n\t\tconsole.log(`${opLabel} index %c${index}%c in %c${parent.path}%c`,\n\t\t\tC.number, C.unset, C.id, C.unset);\n\n\t\tif (isDelete)\n\t\t\tupdateProp.splice(index, 1);\n\t\telse {\n\t\t\tconsole.log('=', value);\n\t\t\tupdateProp.splice(index, 1, value);\n\t\t}\n\t}\n\t// Update or delete other prop\n\telse {\n\t\tconsole.log(`${opLabel} value %c${parent.child}%c in %c${parent.path}%c`,\n\t\t\tC.id, C.unset, C.id, C.unset);\n\n\t\tif (isDelete) {\n\t\t\tdelete updateProp[parent.child];\n\t\t\t// Normal delete only necessary if we aren't inside an array\n\t\t\tif (!inArray) updateProp['-=' + parent.child] = null;\n\t\t}\n\t\telse {\n\t\t\tconsole.log('... Value =', value);\n\t\t\tupdateProp[parent.child] = value;\n\t\t}\n\t}\n};\n\nconst getParentProperty = (path, docData) => {\n\tconst parts = path.split('.');\n\tconst lastProp = parts.pop();\n\tconst parentPath = parts.join('.');\n\tconst parent = fu.getProperty(docData, parentPath);\n\treturn { path: parentPath, value: parent, child: lastProp };\n};\n\n// Restructure array parents\nconst reconstructParentArrays = (docData, path) => {\n\tconst parts = path.split('.');\n\n\tconst updateData = {};\n\tlet currentUpdateProp = updateData,\n\t\tcurrent = docData;\n\n\tlet inArray = false;\n\n\tdo {\n\t\tconst prop = parts.shift();\n\t\tconst value = current[prop];\n\t\tif (Array.isArray(value)) {\n\t\t\tcurrentUpdateProp[prop] = foundry.utils.deepClone(value);\n\t\t\tinArray = true;\n\t\t}\n\t\telse\n\t\t\tcurrentUpdateProp[prop] ??= {};\n\t\tcurrentUpdateProp = currentUpdateProp[prop];\n\t\tcurrent = current[prop];\n\t} while (parts.length);\n\n\treturn { updateData, last: currentUpdateProp, inArray };\n};\n\nexport class DataEditor extends foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.DocumentSheetV2) {\n\t_type;\n\n\tstatic get supportedTypes() { return [DATA_TYPES.number, DATA_TYPES.string, DATA_TYPES.boolean, DATA_TYPES.null, DATA_TYPES.undefined]; }\n\n\tconstructor({ document, path, type, isToken = false, inArray = false, ...options } = {}) {\n\t\tsuper({ document, inArray, path, ...options });\n\n\t\tthis._isToken = isToken;\n\t\tthis._inArray = inArray;\n\n\t\t// this.object = { value: undefined };\n\t\tconst value = fu.getProperty(document.toObject(), path);\n\t\tthis._originalTypeId = type ?? getTypeId(value);\n\t\tthis._originalTypeName = DATA_TYPE_INVERTED[this._originalTypeId];\n\t\tthis._type = this._originalTypeName;\n\t}\n\n\tget title() {\n\t\tconst title = [game.i18n.localize('DataInspector.Title')];\n\t\ttitle.push(this.document.name);\n\t\ttitle.push(this.options.path);\n\t\treturn title.join(': ');\n\t}\n\n\t_initializeApplicationOptions(options) {\n\t\toptions = super._initializeApplicationOptions(options);\n\n\t\tconst documentUuid = options.document.uuid.replace('.', '-');\n\t\tconst safePath = options.path.replaceAll('.', '-');\n\t\toptions.uniqueId = 'data-inspector-' + documentUuid + '-' + safePath;\n\n\t\treturn options;\n\t}\n\n\tstatic DEFAULT_OPTIONS = {\n\t\ttag: 'form',\n\t\tclasses: ['koboldworks', 'data-inspector', 'editor', 'standard-form'],\n\t\tsheetConfig: false,\n\t\twindow: {\n\t\t\tresizable: true,\n\t\t},\n\t\tposition: {\n\t\t\twidth: 520,\n\t\t\theight: 360,\n\t\t},\n\t\tform: {\n\t\t\thandler: this._onSubmit,\n\t\t},\n\t\tactions: {\n\t\t\tdelete: this._onDelete,\n\t\t},\n\t};\n\n\tstatic PARTS = {\n\t\tform: {\n\t\t\ttemplate: `modules/${CFG.id}/template/editor.hbs`,\n\t\t},\n\t\tfooter: {\n\t\t\ttemplate: 'templates/generic/form-footer.hbs',\n\t\t},\n\t};\n\n\tget isUnsupported() {\n\t\tconst value = fu.getProperty(this.document.toObject(), this.options.path),\n\t\t\ttypeId = this._typeId = getTypeId(value);\n\n\t\treturn !this.constructor.supportedTypes.includes(typeId);\n\t}\n\n\tasync _prepareMainContext(context, options) {\n\t\tconst doc = this.document,\n\t\t\tvalue = fu.getProperty(doc.toObject(), this.options.path),\n\t\t\ttypeId = this._typeId = getTypeId(value),\n\t\t\ttypeName = this._type ?? getTypeName(value),\n\t\t\toriginalTypeName = this._originalTypeName;\n\n\t\tcontext.document = doc;\n\t\tcontext.path = this.options.path;\n\t\tcontext.value = value;\n\t\tcontext.type = typeName;\n\t\tcontext.typeName = typeName;\n\t\tcontext.originalType = originalTypeName;\n\t\tcontext.similarType = originalTypeName === 'string' && ['text', 'html'].includes(typeName);\n\t\tcontext.isHTML = typeName === 'html';\n\t\tcontext.isString = ['html', 'text', 'string'].includes(typeName);\n\t\tcontext.isLongString = typeName === 'html' || typeName === 'text' || originalTypeName === 'string' && (context.value.length > 16 || context.value.indexOf('\\n') >= 0);\n\t\tcontext.isUnsupported = this.isUnsupported;\n\t\tcontext.noUpdate = typeName === 'undefined';\n\n\t\tcontext.isActor = doc instanceof Actor;\n\t\tcontext.isItem = doc instanceof Item;\n\t\tcontext.isEditable = !context.isUnsupported;\n\t\tcontext.isOwner = doc.isOwner;\n\t\tcontext.simpleType = ['number', 'string', 'boolean'].includes(typeName);\n\t\tcontext.deadType = ['null', 'undefined'].includes(typeName);\n\t\tcontext.selectedType = this._type;\n\n\t\t// TODO: i18n\n\t\tcontext.types = {\n\t\t\tnumber: 'Number',\n\t\t\tboolean: 'Boolean',\n\t\t\tstring: 'String',\n\t\t\tnull: 'Null',\n\t\t\tundefined: 'Undefined',\n\t\t\ttext: 'Text Block',\n\t\t\thtml: 'HTML',\n\t\t};\n\n\t\tcontext.field = null;\n\t\tswitch (typeName) {\n\t\t\tcase 'number':\n\t\t\t\tcontext.field = new foundry.data.fields.NumberField();\n\t\t\t\tbreak;\n\t\t\tcase 'string':\n\t\t\t\tif (context.isHTML) context.field = new foundry.data.fields.HTMLField();\n\t\t\t\telse context.field = new foundry.data.fields.StringField();\n\t\t\t\tbreak;\n\t\t\tcase 'boolean':\n\t\t\t\tcontext.field = new foundry.data.fields.BooleanField();\n\t\t\t\tbreak;\n\t\t\tcase 'undefined':\n\t\t\tcase 'null':\n\t\t\tcase 'object':\n\t\t\t\tbreak;\n\t\t}\n\n\t\tcontext.isToken = this._isToken;\n\n\t\tcontext.inArray = this._inArray;\n\n\t\tcontext.TYPES = DATA_TYPES;\n\t\treturn context;\n\t}\n\n\tasync _preparePartContext(partId, context, options) {\n\t\tswitch (partId) {\n\t\t\tcase 'form':\n\t\t\t\treturn this._prepareMainContext(context, options);\n\t\t\tcase 'footer': {\n\t\t\t\tconst context = {\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ type: 'submit', label: 'DataInspector.Update', icon: 'fa-solid fa-floppy-disk', action: 'submit' },\n\t\t\t\t\t\t{ type: 'button', label: 'DataInspector.Delete', icon: 'fa-solid fa-trash', action: 'delete' },\n\t\t\t\t\t],\n\t\t\t\t};\n\n\t\t\t\tif (this.isUnsupported) context.buttons.shift();\n\n\t\t\t\treturn context;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @this {DataEditor}\n\t * @param {Event} event\n\t * @param {HTMLElement} elem\n\t */\n\tstatic _onDelete(event, elem) {\n\t\tconst doc = this.document,\n\t\t\tpath = this.options.path;\n\n\t\tconst docData = doc.toObject();\n\n\t\tconst parent = getParentProperty(path, docData);\n\t\tconst update = reconstructParentArrays(docData, parent.path);\n\t\tconst { updateData, inArray } = update;\n\t\tsetUpdateData(update, parent, { isDelete: true, inArray });\n\n\t\tconsole.log('ðŸ”Ž âŒ¦ UpdateData:', updateData);\n\n\t\tconst app = this;\n\t\tDialog.confirm({\n\t\t\ttitle: 'Delete data?',\n\t\t\tcontent: `<p>Delete: <code>${path}</code></p>`,\n\t\t\tyes: () => {\n\t\t\t\tapp.close();\n\t\t\t\tdoc.update(updateData);\n\t\t\t},\n\t\t\tdefaultYes: false,\n\t\t});\n\t}\n\n\t/**\n\t * @param context\n\t * @param options\n\t */\n\t_onRender(context, options) {\n\t\tsuper._onRender(context, options);\n\n\t\tconst html = this.element.querySelector('.window-content');\n\t\tconst app = this;\n\n\t\thtml.querySelector('select[name=\"type\"]')?.addEventListener('change', (ev) => {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t\tconst oldType = this._type,\n\t\t\t\tnewType = ev.target.value;\n\t\t\tthis._type = newType;\n\t\t\t// console.log('Changing type from', oldType, 'to', newType);\n\t\t\tthis.render();\n\t\t});\n\n\t\t// Type swapping\n\t\thtml.querySelector('select[name=\"type\"]')\n\t\t\t?.addEventListener('change', function (ev) {\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t\tapp._type = this.value;\n\t\t\t\tapp.editors = {}; // Reset {{editor}}\n\t\t\t\tapp.render(true);\n\t\t\t});\n\t}\n\n\t/**\n\t * @this {DataEditor}\n\t * @param {Event} event\n\t * @param {*} form\n\t * @param {*} formData\n\t * @returns\n\t */\n\tstatic _onSubmit(event, form, formData) {\n\t\tformData = foundry.utils.expandObject(formData.object);\n\n\t\t// delete formData.type;\n\t\tconst type = this._type,\n\t\t\tpath = this.options.path,\n\t\t\tdoc = this.document;\n\n\t\tlet value = formData.value;\n\t\tif (type === 'undefined') value = undefined;\n\t\telse if (type === 'null') value = null;\n\n\t\tconsole.log('Setting data:', { type, path, value });\n\n\t\tconst docData = doc.toObject();\n\n\t\tconst parent = getParentProperty(path, docData);\n\t\tconst update = reconstructParentArrays(docData, parent.path);\n\t\tconst { updateData } = update;\n\n\t\tupdate.value = value;\n\t\tsetUpdateData(update, parent, { isUpdate: true });\n\n\t\tconsole.log('ðŸ”Ž ï¼‹ UpdateData:', updateData);\n\n\t\ttry {\n\t\t\tdoc.update(updateData);\n\t\t}\n\t\tfinally {\n\t\t\tthis.close();\n\t\t}\n\t}\n}\n",
    "import { getTypeId, getChildTypeId, getModelType, DATA_TYPES, DATA_TYPE_INVERTED } from './data-types.mjs';\n\nconst fu = foundry.utils;\n\nconst dataKeySorter = (a, b) => a.key.localeCompare(b.key);\n\n/**\n * Stub data model for figuring out elements to ignore in them.\n */\nclass StubModel extends (foundry.abstract.TypeDataModel || foundry.abstract.DataModel) {\n\tstatic defineSchema() { return {}; }\n}\n\nconst ignoreDataModelParts = Object.getOwnPropertyNames(new StubModel());\n\nclass ChildKeyData {\n\tkey;\n\ttype;\n\tconstructor(key, type) {\n\t\tthis.key = key;\n\t\tthis.type = type;\n\t}\n}\n\nexport class DataStructure {\n\t/** @type {string} */\n\tkey;\n\t/** @type {string} */\n\tpath;\n\tget basePath() {\n\t\treturn this.path.replace(/^system\\./, '');\n\t}\n\n\t/** @type {string} */\n\tget type() { return DATA_TYPE_INVERTED[this.typeId]; }\n\n\t/** @type {number} */\n\ttypeId;\n\n\t/** @type {DataStructure} */\n\troot;\n\n\t/** @type {*} */\n\tvalue;\n\n\t/** @type {DataStructure} */\n\tparent;\n\t/** @type {DataStructure[]} */\n\tchildren = [];\n\t/** @type {number} */\n\tdepth = 0;\n\t/** @type {string} */\n\ttreetype;\n\n\tget isRollData() {\n\t\treturn this.root.treetype === 'rolldata';\n\t}\n\n\t/** @type {object | undefined} */\n\t_sourceData;\n\t/** @type {object | undefined} */\n\t_derivedData;\n\t/** @type {object | undefined} */\n\t_rollData;\n\t/** @type {object|undefined} */\n\t_overides;\n\n\t/** @type {boolean} */\n\tincludeFunctions = false;\n\n\t/** @type {boolean} */\n\tget isBigString() { return this.typeId === DATA_TYPES.string && this.value?.length > 24; }\n\n\t/** @type {boolean} */\n\tget isNull() { return this.typeId === DATA_TYPES.null; }\n\n\t/** @type {boolean} */\n\tget isFunction() { return this.typeId === DATA_TYPES.function; }\n\n\t/** @type {boolean} */\n\tget isGetter() { return this.typeId === DATA_TYPES.getter; }\n\n\t/** @type {boolean} */\n\tget isUndefined() { return this.typeId === DATA_TYPES.undefined; }\n\n\t/** @type {boolean} */\n\tget isNullish() {\n\t\tif ([DATA_TYPES.null, DATA_TYPES.undefined].includes(this.typeId)) return true;\n\t\tif (this.isArray && this.value.length === 0) return true;\n\t\tif (this.isSet && this.value.size === 0) return true;\n\t\tif ((this.isMap || this.isCollection) && this.value.size == 0) return true;\n\t\treturn false;\n\t}\n\n\t/** @type {string|null} */\n\tget identifier() {\n\t\tswitch (this.typeId) {\n\t\t\tcase DATA_TYPES.custom:\n\t\t\tcase DATA_TYPES.model: return this.value.constructor.name;\n\t\t\tdefault: return null;\n\t\t}\n\t}\n\n\tget isModel() { return this.typeId === DATA_TYPES.model; }\n\n\t/** @type {boolean} */\n\tget isArray() { return this.typeId === DATA_TYPES.array; }\n\n\tget isSet() { return this.typeId === DATA_TYPES.set; }\n\n\tget isArrayLike() { return this.isArray || this.isSet; }\n\n\tget isMap() { return this.typeId === DATA_TYPES.map; }\n\n\tget isCollection() { return this.typeId === DATA_TYPES.collection; }\n\n\t/** @type {boolean} */\n\tget isObject() { return this.typeId === DATA_TYPES.object; }\n\n\tget isUndesirable() {\n\t\treturn this.isDocument || [DATA_TYPES.placeable, DATA_TYPES.pixi, DATA_TYPES.app].includes(this.typeId);\n\t}\n\n\t/** @type {boolean} */\n\tget isDocument() { return [DATA_TYPES.document].includes(this.typeId); }\n\n\t/** @type {string} */\n\tget documentId() {\n\t\tif (this.typeId === DATA_TYPES.document) return this.value.id;\n\t\treturn undefined;\n\t}\n\n\tget hasName() {\n\t\tif (this.isContainer) {\n\t\t\treturn ('name' in this.value || 'label' in this.value || 'title' in this.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tget name() {\n\t\treturn this.value.name || this.value.label || this.value.title;\n\t}\n\n\tget hasValues() {\n\t\tif (this.isContainer && !this.isArrayLike) {\n\t\t\treturn ('total' in this.value || 'value' in this.value || 'max' in this.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tget values() {\n\t\tconst data = {\n\t\t\tvalue: this.value.value,\n\t\t\thaveValue: false,\n\t\t\tmax: this.value.max,\n\t\t\thaveMax: false,\n\t\t\tisValue: false,\n\t\t\ttotal: this.value.total,\n\t\t\thaveTotal: false,\n\t\t\tnoValues: false,\n\t\t};\n\n\t\tif (data.value === null || (typeof data.value === 'number')) {\n\t\t\tdata.value = `${data.value}`;\n\t\t\tdata.haveValue = true;\n\t\t}\n\t\tif (data.max === null || (typeof data.max === 'number')) {\n\t\t\tdata.max = `${data.max}`;\n\t\t\tdata.haveMax = true;\n\t\t}\n\t\tif (data.total === null || (typeof data.total === 'number')) {\n\t\t\tdata.total = `${data.total}`;\n\t\t\tdata.haveTotal = true;\n\t\t}\n\t\tif (data.haveValue || data.haveMax) {\n\t\t\tdata.isValue = true;\n\t\t\tdata.isValueOf = data.haveValue && data.haveMax;\n\t\t}\n\n\t\tif (!data.isValue && !data.haveTotal) data.noValues = true;\n\n\t\treturn data;\n\t}\n\n\t/** @type {string} */\n\tget className() { return this.value.__proto__?.constructor.name; }\n\n\t/** @type {boolean} */\n\tget isEmpty() {\n\t\tif (this.isNullish) return true;\n\t\tswitch (this.typeId) {\n\t\t\tcase DATA_TYPES.string:\n\t\t\tcase DATA_TYPES.array:\n\t\t\t\treturn this.value.length == 0;\n\t\t\tcase DATA_TYPES.object:\n\t\t\t\treturn fu.isEmpty(this.value);\n\t\t\tcase DATA_TYPES.map:\n\t\t\tcase DATA_TYPES.collection:\n\t\t\t\treturn this.value.size === 0;\n\t\t\tcase DATA_TYPES.custom:\n\t\t\t\treturn this.children.length == 0;\n\t\t}\n\t\treturn false;\n\t}\n\n\tget isEmptyPrimitive() {\n\t\treturn this.isNull || this.isUndefined;\n\t}\n\n\trecursionPoint = false;\n\n\t/** @type {boolean} */\n\tget isPrimitive() {\n\t\treturn this.isBoolean || this.isNumber || this.isString || this.isNull || this.isUndefined;\n\t}\n\n\t/** @type {boolean} */\n\tget isBoolean() { return this.typeId === DATA_TYPES.boolean; }\n\t/** @type {boolean} */\n\tget isString() { return this.typeId === DATA_TYPES.string; }\n\t/** @type {boolean} */\n\tget isNumber() { return this.typeId === DATA_TYPES.number; }\n\n\t/** @type {boolean} */\n\tget inArray() { return this.parent?.isArrayLike ?? false; }\n\n\t/** @type {boolean} */\n\tget isContainer() {\n\t\tif (this.recursionPoint) return false;\n\t\treturn [DATA_TYPES.array, DATA_TYPES.set, DATA_TYPES.object, DATA_TYPES.model, DATA_TYPES.map, DATA_TYPES.collection, DATA_TYPES.custom].includes(this.typeId);\n\t}\n\n\tget isChildless() { return [DATA_TYPES.boolean, DATA_TYPES.string, DATA_TYPES.null, DATA_TYPES.undefined, DATA_TYPES.number].includes(this.typeId); }\n\n\t/** @type {boolean} */\n\tget isCustom() { return this.typeId === DATA_TYPES.custom; }\n\n\t/** @type {string} */\n\tget formattedValue() {\n\t\tswitch (this.typeId) {\n\t\t\tcase DATA_TYPES.undefined: return 'undefined';\n\t\t\tcase DATA_TYPES.null: return 'null';\n\t\t\tcase DATA_TYPES.function: return 'function';\n\t\t}\n\t\treturn this.value;\n\t}\n\n\t#inRoll;\n\t/** @type {boolean} */\n\tget inRollData() {\n\t\tif (this.#inRoll === undefined) {\n\t\t\tif (this.root.treetype === 'rolldata') return this.#inRoll = true;\n\t\t\tif (!this.root._rollData) return false;\n\t\t\tconst path = this.basePath;\n\t\t\ttry {\n\t\t\t\t// BUG: This fails with Set\n\t\t\t\treturn this.#inRoll = fu.hasProperty(this.root._rollData, path);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\t/* fu.hasProperty() doesn't like \"invalid\" data  */\n\t\t\t}\n\t\t\treturn this.#inRoll = 3;\n\t\t}\n\t\treturn this.#inRoll;\n\t}\n\n\t#inSource;\n\t/** @type {boolean} */\n\tget inSourceData() {\n\t\tif (this.#inSource === undefined) {\n\t\t\tif (this.root.treetype === 'source')\n\t\t\t\treturn this.#inSource = true;\n\t\t\tif (!this.root._sourceData)\n\t\t\t\treturn false;\n\t\t\tconst path = this.basePath;\n\t\t\ttry {\n\t\t\t\tconst data = this.root._sourceData;\n\t\t\t\treturn (this.#inSource = fu.hasProperty(data, path));\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\t/* fu.hasProperty() doesn't like \"invalid\" data  */\n\t\t\t}\n\t\t\treturn (this.#inSource = 3);\n\t\t}\n\t\treturn this.#inSource;\n\t}\n\n\t#inDerived;\n\t/** @type {boolean} */\n\tget inDerivedData() {\n\t\tif (this.#inDerived === undefined) {\n\t\t\tif (this.root.treetype === 'derived') return this.#inDerived = true;\n\t\t\tif (!this.root._derivedData) return false;\n\t\t\tconst path = this.basePath;\n\t\t\ttry {\n\t\t\t\tconst data = this.root._derivedData;\n\t\t\t\treturn this.#inDerived = fu.hasProperty(data, path);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\t/* fu.hasProperty() doesn't like \"invalid\" data  */\n\t\t\t}\n\t\t\treturn this.#inDerived = 3;\n\t\t}\n\t\treturn this.#inDerived;\n\t}\n\n\t#inTemporary;\n\t/** @type {boolean} */\n\tget inTemporaryData() {\n\t\tif (this.#inTemporary === undefined) {\n\t\t\tif (!this.root._temporaryData) return false;\n\t\t\tconst path = this.basePath;\n\t\t\ttry {\n\t\t\t\tconst data = this.root._temporaryData;\n\t\t\t\treturn this.#inTemporary = fu.hasProperty(data, path);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\t/* fu.hasProperty() doesn't like \"invalid\" data  */\n\t\t\t}\n\t\t\treturn this.#inTemporary = 3;\n\t\t}\n\t\treturn this.#inTemporary;\n\t}\n\n\tget hasOverrides() {\n\t\treturn !!this._overrides;\n\t}\n\n\t/** @type {string} */\n\tget css() {\n\t\tif (this.typeId === DATA_TYPES.boolean)\n\t\t\treturn this.value ? 'true' : 'false';\n\t\tif (this.typeId === DATA_TYPES.number)\n\t\t\treturn this.value === 0 ? 'zero' : this.value < 0 ? 'negative' : 'positive';\n\t\treturn '';\n\t}\n\n\t/**\n\t * @param {object} options\n\t * @param {string} options.key\n\t * @param {string} options.path\n\t * @param {*} options.value\n\t * @param {DataStructure} options.parent\n\t * @param {DATA_TYPES} options.type\n\t * @param {\"rolldata\"|\"derived\"|\"source\"} options.treeType\n\t * @param {number} options.depth\n\t */\n\tconstructor({ key, path, value, parent, type, treeType, depth }) {\n\t\tthis.key = key;\n\t\tthis.path = path;\n\t\tthis.typeId = type ?? getTypeId(value);\n\t\tthis.value = value;\n\t\tthis.parent = parent;\n\t\tthis.root = parent?.root ?? parent;\n\t\tthis.depth = depth;\n\t\tthis.treetype = treeType;\n\n\t\tthis.includeFunctions = parent?.includeFunctions ?? false;\n\n\t\t// if (this.typeId === DATA_TYPES.custom) console.log(this.type, this.typeId, value, value.constructor.name);\n\t}\n\n\t#childKeys;\n\t/** @type {ChildKeyData[]} */\n\tchildKeys() {\n\t\tif (this.#childKeys) return this.#childKeys;\n\t\tif (this.isUndesirable) return [];\n\t\tswitch (this.typeId) {\n\t\t\tcase DATA_TYPES.set:\n\t\t\t\treturn this.#childKeys = [Array.from(this.value).map(k => new ChildKeyData(k))];\n\t\t\tcase DATA_TYPES.array:\n\t\t\t\treturn this.#childKeys = [this.value.map(k => new ChildKeyData(k))];\n\t\t\tcase DATA_TYPES.collection:\n\t\t\tcase DATA_TYPES.map:\n\t\t\t\treturn this.#childKeys = [Array.from(this.value.keys()).map(k => new ChildKeyData(k))];\n\t\t\tcase DATA_TYPES.model:\n\t\t\tcase DATA_TYPES.object:\n\t\t\tcase DATA_TYPES.custom: {\n\t\t\t\tconst allKeys = [], rvg = [], rvf = [];\n\t\t\t\tconst props = Object.getOwnPropertyNames(this.value).filter(k => {\n\t\t\t\t\tif (this.isModel)\n\t\t\t\t\t\treturn !ignoreDataModelParts.includes(k);\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t\tallKeys.push(...props.map(k => new ChildKeyData(k)));\n\n\t\t\t\tif (this.includeFunctions) {\n\t\t\t\t\t// Find getters also\n\t\t\t\t\tlet proto = this.value;\n\t\t\t\t\tif ([DATA_TYPES.custom, DATA_TYPES.object, DATA_TYPES.model].includes(this.typeId)) {\n\t\t\t\t\t\tconst ignored = ['constructor', 'toString', 'almostEqual', '__proto__', 'prototype', 'between', 'toObject', 'toJSON', 'clone'];\n\t\t\t\t\t\tconst ignoreModelBits = [...ignoreDataModelParts, 'schema', 'validationFailures', 'invalid', 'validate', 'update', 'updateSource', 'reset'];\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tconst keys = Object.getOwnPropertyNames(proto);\n\t\t\t\t\t\t\tfor (const key of keys) {\n\t\t\t\t\t\t\t\tif (key.startsWith('_')) continue;\n\t\t\t\t\t\t\t\tif (ignored.includes(key)) continue;\n\n\t\t\t\t\t\t\t\tif (this.isModel && ignoreModelBits.includes(key)) continue;\n\n\t\t\t\t\t\t\t\tconst cType = getChildTypeId(proto, key);\n\t\t\t\t\t\t\t\tif (cType === DATA_TYPES.getter)\n\t\t\t\t\t\t\t\t\trvg.push(new ChildKeyData(key, DATA_TYPES.getter));\n\t\t\t\t\t\t\t\telse if (cType === DATA_TYPES.function)\n\t\t\t\t\t\t\t\t\trvf.push(new ChildKeyData(key, DATA_TYPES.function));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tproto = Object.getPrototypeOf(proto);\n\t\t\t\t\t\t\tif (proto?.__proto__ == null) break;\n\t\t\t\t\t\t} while (proto);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn this.#childKeys = [allKeys.sort(dataKeySorter), rvg.sort(dataKeySorter), rvf.sort(dataKeySorter)];\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn this.#childKeys = [];\n\t\t}\n\t}\n\n\tfillChildren() {\n\t\tif (this.recursionPoint) return [];\n\n\t\tconst curpath = this.path,\n\t\t\tbasePath = curpath?.length ? curpath : this.key,\n\t\t\tisArrayLike = this.isArrayLike,\n\t\t\tisMap = this.isMap || this.isCollection,\n\t\t\tisSet = this.isSet;\n\n\t\tconst saferValue = isSet ? Array.from(this.value) : this.value;\n\n\t\tconst parseChildren = (list) => {\n\t\t\tlist?.forEach((ckData, i) => {\n\t\t\t\tconst { key, type } = ckData;\n\t\t\t\tconst childKey = !isArrayLike ? key : i;\n\t\t\t\tconst path = basePath ? `${basePath}.${childKey}` : childKey;\n\n\t\t\t\tconst hookId = 'data-inspector.filterData';\n\t\t\t\tif (Hooks.events[hookId]) {\n\t\t\t\t\tif (Hooks.call(hookId, this.root.document, path, this.treetype) === false) return;\n\t\t\t\t}\n\n\t\t\t\tconst value = isMap ? this.value.get(childKey) : saferValue[childKey],\n\t\t\t\t\ttypeId = getTypeId(value);\n\n\t\t\t\tif (typeId === DATA_TYPES.function && !this.includeFunctions) return; // Not including functions\n\n\t\t\t\tconst c = new DataStructure({ key: childKey, path, value, parent: this, type, depth: this.depth + 1 });\n\t\t\t\tthis.children.push(c);\n\t\t\t});\n\t\t};\n\n\t\tconst [all, functions, getters] = this.childKeys();\n\n\t\tparseChildren(all);\n\t\tparseChildren(functions);\n\t\tparseChildren(getters);\n\n\t\treturn this.children;\n\t}\n\n\tstatic recurse(sourceData, key, path, type, { includeFunctions = false, document } = {}) {\n\t\tthis.includeFunctions = includeFunctions ?? false;\n\n\t\tconst dt = new DataStructure({ key, path, value: sourceData, parent: null, treeType: type, depth: 0 });\n\t\tdt.document = document;\n\t\tdt.root = dt;\n\t\tconst all = {};\n\t\tif (dt.path) all[dt.path] = dt;\n\t\tlet itemCount = 0, error = false, maxDepth = 0;\n\n\t\tconst visitedNodes = new Map();\n\n\t\t/**\n\t\t * @param {DataStructure} ds\n\t\t */\n\t\tconst handleChild = (ds) => {\n\t\t\tall[ds.path] = ds;\n\n\t\t\tif (maxDepth < ds.depth) maxDepth = ds.depth;\n\n\t\t\titemCount++;\n\t\t\tif (itemCount > 25000) {\n\t\t\t\tif (!error) {\n\t\t\t\t\tui.notifications.error('DATA INSPECTOR | Possible cyclic reference encountered; ending inspection early', { console: false });\n\t\t\t\t\tconsole.error(ds.path, '\\nDATA INSPECTOR | Possible cyclic reference encountered; ending inspection early\\n', ds);\n\t\t\t\t\terror = true;\n\t\t\t\t}\n\t\t\t\treturn; // Arbitrary hard exit\n\t\t\t}\n\n\t\t\tif (!ds.isPrimitive) {\n\t\t\t\tconst old = visitedNodes.get(ds.value);\n\t\t\t\tif (old) {\n\t\t\t\t\tds.recursionPoint = old;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tvisitedNodes.set(ds.value, ds.path);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\trecurseChildren(ds);\n\t\t\t}\n\t\t\tcatch (err) {\n\t\t\t\tconsole.error(err, this);\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @param {DataStructure} ds\n\t\t */\n\t\tconst recurseChildren = (ds) => {\n\t\t\tif (!ds.isChildless) {\n\t\t\t\tds.fillChildren()\n\t\t\t\t\t.forEach(handleChild);\n\t\t\t}\n\t\t};\n\n\t\trecurseChildren(dt);\n\n\t\treturn { root: dt, all, count: itemCount, depth: maxDepth };\n\t}\n\n\t/*\n\thasChild(path) {\n\t\tconst parts = path.split('.');\n\t}\n\t*/\n\n\t/**\n\t * @param {string} path\n\t * @returns {DataStructure}\n\t */\n\tgetAtPath(path) {\n\t\tconst parts = path.split('.');\n\t\tconst key = parts.shift();\n\n\t\tconst getPart = () => {\n\t\t\tswitch (this.typeId) {\n\t\t\t\tcase DATA_TYPES.set:\n\t\t\t\tcase DATA_TYPES.array: return this.children[parseInt(key)];\n\t\t\t\tdefault: return this.children.find(cd => cd.key === key);\n\t\t\t}\n\t\t};\n\n\t\tconst c = getPart();\n\n\t\tif (parts.length === 0) return c;\n\t\telse if (c) return c.getAtPath(parts.join('.'));\n\t}\n}\n",
    "export class SearchResult {\n\t/** @type {string} */\n\tpath;\n\n\t/** @type {boolean} */\n\tkeyFocus = true;\n\n\t/** @type {boolean} */\n\tmatch;\n\n\t/** @type {boolean} */\n\tget mismatch() { return this.indexes.path.length === 0; }\n\n\t/**\n\t * Search target, what is being looked for.\n\t *\n\t * @type {object}\n\t */\n\ttarget;\n\t/** @type {number} */\n\tscore;\n\n\t/** @type {boolean} */\n\tkeyFullMatch;\n\t/** @type {boolean} */\n\tpathFullMatch;\n\n\tindexes = {\n\t\t/** @type {number[]} */\n\t\tpath: [],\n\t\t/** @type {number[]} */\n\t\tkey: [],\n\t};\n\n\t/** @type {number} */\n\tratio;\n\t/** @type {boolean} */\n\tget good() { return this.ratio > 0.8; }\n\t/** @type {boolean} */\n\tget bad() { return this.ratio < 0.3; }\n\tscoring = {\n\t\t/** @type {number} */\n\t\tfull: undefined,\n\t\t/** @type {number} */\n\t\tkey: undefined,\n\t};\n\n\tconstructor({ path, match, target, score, keyFocus, keyFullMatch, pathFullMatch, pathIndexes, keyIndexes, ratio, scoring } = {}) {\n\t\tthis.path = path;\n\t\tthis.match = match;\n\t\tthis.target = target;\n\n\t\tthis.keyFocus = keyFocus;\n\n\t\tthis.score = score;\n\t\tthis.keyFullMatch = keyFullMatch;\n\t\tthis.pathFullMatch = pathFullMatch;\n\t\tthis.indexes.path = pathIndexes;\n\t\tthis.indexes.key = keyIndexes;\n\n\t\tthis.ratio = ratio;\n\n\t\tthis.scoring = scoring;\n\t}\n}\n",
    "export class TermMatch {\n\t/** @type {number} */\n\tscore;\n\t/** @type {number[]} */\n\tindexes;\n\tfull;\n\thalf;\n\t/** @type {number} */\n\tratio;\n\t/** @type {number} */\n\tconsecutives;\n\t/** @type {number} */\n\tlongestChain;\n\t/** @type {Score[]} */\n\tscoring;\n\n\tconstructor({ indexes, full, half, ratio, consecutives, longestChain, scoring } = {}) {\n\t\tthis.indexes = indexes;\n\t\tthis.full = full;\n\t\tthis.half = half;\n\t\tthis.ratio = ratio;\n\t\tthis.consecutives = consecutives;\n\t\tthis.longestChain = longestChain;\n\t\tthis.scoring = scoring;\n\t\tthis.score = scoring.reduce((old, scr) => old + scr.value);\n\t}\n}\n",
    "export class Score {\n\t/** @type {number} */\n\tvalue;\n\t/** @type {string} */\n\tdescription;\n\n\t/**\n\t * @param {number} value\n\t * @param {string} description\n\t */\n\tconstructor(value, description) {\n\t\tthis.value = value;\n\t\tthis.description = description;\n\t}\n}\n",
    "import { CFG } from './config.mjs';\nimport { getTypeId, getChildTypeId, DATA_TYPES, DATA_TYPE_INVERTED } from './data-types.mjs';\nimport { DataEditor } from './data-editor.mjs';\nimport { DataStructure } from './data-structure.mjs';\n\nimport { SearchResult } from './data/search-result.mjs';\nimport { TermMatch } from './data/term-match.mjs';\nimport { Score } from './data/score.mjs';\n\nconst fu = foundry.utils;\n\n// Crude deepClone\nfunction getSafeCopy(value, _visited = new Set()) {\n\tif (value === null) return value;\n\tif (value === undefined) return value;\n\tif (Array.isArray(value)) return value.map(v => getSafeCopy(v, _visited));\n\tif (['string', 'number', 'boolean'].includes(typeof value)) return value;\n\n\tif (value instanceof Set) return [...value].map(v => getSafeCopy(v, _visited));\n\n\tif (_visited.has(value)) return '<<INFINITE LOOP>>'; // Safeguard against infinite loops\n\t_visited.add(value);\n\n\tvalue = { ...value };\n\tfor (const [path, pvalue] of Object.entries(value)) {\n\t\tvalue[path] = getSafeCopy(pvalue, _visited);\n\t}\n\n\treturn value;\n}\n\n/**\n * @param {Actor|Item} doc Original document to mimic\n * @returns {Actor|Item} New temporary document of same type with minimal initialization.\n */\nfunction createTemporaryDocument(doc) {\n\tconst data = { name: doc.name + ' [Temporary]', type: doc.type, system: {} };\n\tconst hookId = 'data-inspector.temporaryData';\n\tif (Hooks.events[hookId]) Hooks.callAll(hookId, doc, data);\n\treturn doc instanceof Actor ? new Actor.implementation(data) : new Item.implementation(data);\n}\n\nexport class DataBrowser extends foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.ApplicationV2) {\n\tstatic EDITABLE_MODES = ['source', 'override', 'flags'];\n\n\t_path = '';\n\t/** @type {Element} */\n\t_pathEl;\n\t_search = '';\n\t_searchEnd = true;\n\t_functions = game.settings.get(CFG.id, CFG.SETTINGS.functions);\n\n\t_document = false;\n\t_mode = game.settings.get(CFG.id, CFG.SETTINGS.mode);\n\t_expandedItems = new Set();\n\t_derivedData;\n\t_sourceData;\n\t_temporaryData;\n\t_rollData;\n\t_flagData;\n\t_overrides;\n\t_resultQuality = game.settings.get(CFG.id, CFG.SETTINGS.results);\n\t/** @type {DataStructure} */\n\troot;\n\n\tpaths;\n\n\t/** @type {foundry.documents.Item|foundry.documents.Actor} */\n\tget document() {\n\t\treturn this.options.document;\n\t}\n\n\t/** @type {foundry.abstract.DataModel} */\n\tget object() {\n\t\treturn this.options.object ?? this.document;\n\t}\n\n\t_initializeApplicationOptions(options) {\n\t\tif (!options.document && !options.object) throw new Error('Need an object to browse');\n\n\t\tif (options.object instanceof foundry.abstract.Document)\n\t\t\toptions.root ??= 'system';\n\n\t\toptions = super._initializeApplicationOptions(options);\n\n\t\tconst uuid = options.object?.uuid || options.document?.uuid;\n\t\tif (uuid) options.uniqueId = 'data-inspector-' + uuid.replace('.', '-');\n\t\telse options.uniqueId = 'data-inspector-' + options.uniqueId;\n\n\t\treturn options;\n\t}\n\n\tget title() {\n\t\tconst title = [];\n\n\t\tconst doc = this.document;\n\t\t// Parent document\n\t\tif (doc) {\n\t\t\tconst parent = doc.actor;\n\n\t\t\t// TODO: Support artificial nesting by systems (e.g. containers)\n\n\t\t\t// Parent actor if it exists\n\t\t\tif (parent) title.push(parent.name);\n\n\t\t\t// Parent item if it's different from inspected object\n\t\t\ttitle.push(doc.name);\n\t\t}\n\n\t\t// Explicit target object title\n\t\tconst tf = this.options.title;\n\t\tif (tf && doc !== this.object) {\n\t\t\tif (typeof tf === 'function') title.push(tf(this, this.object));\n\t\t\telse title.push(tf);\n\t\t}\n\n\t\treturn game.i18n.localize('DataInspector.Title') + ': ' + title.join(' > ');\n\t}\n\n\tstatic DEFAULT_OPTIONS = {\n\t\ttag: 'form',\n\t\tviewPermission: 'OBSERVER',\n\t\tclasses: ['koboldworks', 'data-inspector', 'browser'],\n\t\twindow: {\n\t\t\tresizable: true,\n\t\t\ticon: 'fa-solid fa-atom',\n\t\t},\n\t\tposition: {\n\t\t\twidth: 580,\n\t\t\theight: 620,\n\t\t},\n\t\tsheetConfig: false,\n\t\tactions: {\n\t\t\texpandPath: this._onExpandPath,\n\t\t},\n\t};\n\n\tstatic PARTS = {\n\t\theader: {\n\t\t\ttemplate: `modules/${CFG.id}/template/header.hbs`,\n\t\t},\n\t\tform: {\n\t\t\ttemplate: `modules/${CFG.id}/template/inspector.hbs`,\n\t\t\ttemplates: ['object', 'inspector', 'value', 'object-data']\n\t\t\t\t.map(t => `modules/${CFG.id}/template/${t}.hbs`),\n\t\t\tscrollable: ['.datatree > .dataview'],\n\t\t},\n\t\tfooter: {\n\t\t\ttemplate: `modules/${CFG.id}/template/footer.hbs`,\n\t\t},\n\t};\n\n\t/*\n\t// Deny header buttons\n\t_getHeaderButtons() {\n\t\treturn super._getHeaderButtons().filter(b => b.class === 'close');\n\t}\n\t*/\n\n\tgetDataVariant(doc, mode) {\n\t\tlet root = this.options.root ?? null;\n\t\tif (doc instanceof foundry.abstract.Document) root ??= 'system';\n\n\t\tmode ||= this._mode;\n\n\t\tswitch (mode) {\n\t\t\tcase 'flags':\n\t\t\t\tif (this._flagData == null) this._flagData = doc.flags ?? {};\n\t\t\t\treturn { data: this._flagData, path: 'flags' };\n\t\t\tcase 'override':\n\t\t\t\tif (this._overrides == null) {\n\t\t\t\t\tthis._overrides = doc.token?.delta.toObject() ?? {};\n\t\t\t\t\tif (root) this._overrides = foundry.utils.getProperty(this._overrides, root) ?? {};\n\t\t\t\t}\n\t\t\t\treturn { data: this._overrides, path: root };\n\t\t\tcase 'rolldata':\n\t\t\t\tif (this._rollData == null) this._rollData = doc.getRollData();\n\t\t\t\treturn { data: this._rollData, path: '' };\n\t\t\tcase 'source':\n\t\t\t\tif (this._sourceData == null) {\n\t\t\t\t\tthis._sourceData = doc.toObject();\n\t\t\t\t\tif (root) this._sourceData = foundry.utils.getProperty(this._sourceData, root) ?? {};\n\t\t\t\t}\n\t\t\t\treturn { data: this._sourceData, path: root };\n\t\t\tdefault:\n\t\t\tcase 'derived': {\n\t\t\t\tif (this._derivedData == null) {\n\t\t\t\t\tthis._derivedData = doc;\n\t\t\t\t\tif (root) this._derivedData = foundry.utils.getProperty(this._derivedData, root);\n\t\t\t\t}\n\t\t\t\treturn { data: this._derivedData, path: root };\n\t\t\t}\n\t\t}\n\t}\n\n\tgetBaseData() {\n\t\tconst doc = this.object;\n\n\t\tswitch (this._mode) {\n\t\t\tcase 'flags':\n\t\t\t\treturn doc.flags ?? {};\n\t\t\tcase 'override':\n\t\t\t\treturn doc.token?.actorData ?? {};\n\t\t\tcase 'rolldata':\n\t\t\t\treturn doc.getRollData();\n\t\t\tcase 'source':\n\t\t\t\treturn doc.toObject();\n\t\t\tdefault:\n\t\t\tcase 'derived':\n\t\t\t\treturn doc;\n\t\t}\n\t}\n\n\tasync _prepareContext(options) {\n\t\tconst doc = this.object;\n\t\tconst isDocument = doc instanceof foundry.abstract.Document;\n\n\t\tconst context = {},\n\t\t\tisActor = doc instanceof Actor,\n\t\t\ttype = doc.type;\n\n\t\tif (isDocument && this._mode === 'source') {\n\t\t\tthis._temporaryData ??= createTemporaryDocument(doc).toObject();\n\t\t}\n\n\t\t// Include prefix to mimic other data structures for easier handling all around (no need for special cases)\n\t\tcontext.rolldata = this.getDataVariant(doc, 'rolldata').data;\n\t\tcontext.sourcedata = this.getDataVariant(doc, 'source').data;\n\t\tcontext.derived = this.getDataVariant(doc, 'derived').data;\n\t\tif (isActor) context.overrides = this.getDataVariant(doc, 'override').data;\n\t\tcontext.flags = this.getDataVariant(doc, 'flags').data;\n\n\t\tconst { data: docData, path: basePath } = this.getDataVariant(doc);\n\n\t\tcontext.document = doc;\n\t\t// data.overrides = doc.overrides;\n\t\tcontext.type = type;\n\t\tconst typeLabelKey = isDocument ? CONFIG[doc.documentName].typeLabels[type] : null;\n\t\tcontext.typeLabel = typeLabelKey ? game.i18n.localize(typeLabelKey) : null;\n\t\tcontext.objectType = doc.constructor.name;\n\t\tcontext.dataType = this._mode;\n\t\tcontext.isRollData = this._mode === 'rolldata';\n\t\tcontext.isSourceData = this._mode === 'source';\n\t\tcontext.isDerivedData = this._mode === 'derived';\n\t\tcontext.isOverrideData = this._mode === 'override';\n\t\tcontext.resultQuality = this._resultQuality;\n\t\tconst isRollData = this._mode === 'rolldata';\n\t\tconst isFlags = this._mode === 'flags';\n\n\t\tconst { root, all, count, depth } = DataStructure.recurse(docData, basePath, basePath, this._mode, { includeFunctions: this._functions, document: doc });\n\t\tcontext.data = root;\n\t\tthis.root = root;\n\t\tcontext.count = count;\n\t\tcontext.depth = depth;\n\n\t\tcontext.model = root.isModel ? root.className : game.i18n.localize('DataInspector.NotAvailable');\n\t\tif (root.treetype === 'source') {\n\t\t\tif (doc instanceof foundry.abstract.Document) {\n\t\t\t\tcontext.model = doc.system instanceof foundry.abstract.DataModel ? doc.system.constructor.name : game.i18n.localize('DataInspector.NotAvailable');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcontext.model = doc instanceof foundry.abstract.DataModel ? doc.constructor.name : game.i18n.localize('DataInspector.NotAvailable');\n\t\t\t}\n\t\t}\n\n\t\tcontext.dataTypes = {\n\t\t\trolldata: 'DataInspector.Data.Roll',\n\t\t\tderived: 'DataInspector.Data.Derived',\n\t\t\tsource: 'DataInspector.Data.Source',\n\t\t\toverride: 'DataInspector.Data.Override',\n\t\t\tflags: 'DataInspector.Data.Flags',\n\t\t};\n\t\tif (!context.data.hasOverrides) delete context.dataTypes.override;\n\t\tif (!this.object.getRollData) delete context.dataTypes.rolldata;\n\t\tif (!this.object.flags) delete context.dataTypes.flags;\n\t\tif (!this.object.toObject) {\n\t\t\tdelete context.dataTypes.source;\n\t\t}\n\n\t\troot._sourceData = context.sourcedata;\n\t\troot._derivedData = context.derived;\n\t\troot._rollData = context.rolldata;\n\t\troot._overrides = context.overrides;\n\t\troot._temporaryData = this._temporaryData?.system;\n\n\t\tcontext.uuid = doc.uuid;\n\t\tcontext.search = this._search;\n\t\tcontext.searchEnd = this._searchEnd;\n\t\tcontext.includeFunctions = this._functions;\n\t\tcontext.includeDocument = this._document;\n\t\tcontext.path = this._path;\n\n\t\tcontext.TYPES = DATA_TYPES;\n\n\t\treturn context;\n\t}\n\n\t/**\n\t * @param {Element} el\n\t * @param {ElementHandler} callback\n\t * @param {...any} args\n\t */\n\t_treeWalker(el, callback, ...args) {\n\t\tcallback(el, ...args);\n\t\tconst parent = el.parentElement;\n\t\tif (parent && ['LI', 'UL'].includes(parent.tagName))\n\t\t\tthis._treeWalker(parent, callback, ...args);\n\t}\n\n\t/**\n\t * @param {Element} el\n\t * @param {boolean} enabled\n\t */\n\t_highlightEl(el, enabled = true) {\n\t\t// console.log('Highlighting!');\n\t\tif (this._pathEl) this._pathEl.classList.toggle('selected', false);\n\t\tel.classList.toggle('selected', enabled);\n\t\tthis._pathEl = el;\n\t}\n\n\t/**\n\t * @param {Element} el\n\t */\n\t_expandDataElTree(el) {\n\t\tthis._treeWalker(el, this._expandDataEl, false, true);\n\t}\n\n\t/**\n\t * @param {Element} el\n\t * @param {boolean} record\n\t * @param {boolean} expand\n\t */\n\t_expandDataEl(el, record = true, expand = undefined) {\n\t\tel.classList.toggle('hide', false);\n\n\t\tif (el.classList.contains('value') || el.classList.contains('empty')) {\n\t\t\t// console.log('Don\\'t expand empty or value entry');\n\t\t\treturn;\n\t\t}\n\n\t\t// Record open state\n\t\tif (record) {\n\t\t\tconst path = el.dataset.path;\n\t\t\tconst items = this._expandedItems;\n\t\t\tel.classList.contains('collapsed') ? items.add(path) : items.delete(path);\n\t\t}\n\n\t\t// Toggle collapse\n\t\tel.classList.toggle('collapsed', expand !== undefined ? !expand : undefined);\n\t\tel.classList.toggle('expanded', expand);\n\t}\n\n\t/**\n\t * @param {Element} el\n\t * @param hide\n\t * @param includeValues\n\t */\n\tcollapseAndClearEl(el, hide = false, includeValues = false) {\n\t\tel.classList.toggle('hide', hide);\n\t\tel.dataset.matchQuality = null;\n\t\tel.classList.toggle('selected', false);\n\t\tif (el.classList.contains('value') || el.classList.contains('empty')) return;\n\t\tel.classList.toggle('collapsed', true);\n\t\tel.classList.toggle('expanded', false);\n\t}\n\n\t/**\n\t * @this {DataBrowser}\n\t * @param {Event} ev\n\t * @param {HTMLElement} el\n\t */\n\tstatic _onExpandPath(ev, el) {\n\t\tev.stopPropagation();\n\n\t\tthis._expandDataEl(el);\n\t}\n\n\t/**\n\t * @this {DataBrowser}\n\t * @param {PointerEvent} ev\n\t * @param {HTMLElement} elem\n\t */\n\tstatic _onCopyPath(ev, elem) {\n\t\tconst path = elem.closest('[data-path]').dataset.path;\n\t\tif (!path) {\n\t\t\tui.notifications.error('Failed to parse data path.');\n\t\t\treturn void console.error('Failed to parse path from', { path, element: elem });\n\t\t}\n\n\t\tconst properPath = this._mode === 'rolldata' ? `@${path}` : path;\n\n\t\t// pathInput.value = properPath;\n\n\t\tconsole.log(`Saving path %c${path}%c to clipboard`, CFG.COLORS.id, CFG.COLORS.unset);\n\t\tgame.clipboard.copyPlainText(properPath)\n\t\t\t.then(() => ui.notifications.info(game.i18n.format('DataInspector.Info.CopyPath', { path })));\n\t}\n\n\t/**\n\t * @this {DataBrowser}\n\t * @param {PointerEvent} ev\n\t * @param {HTMLElement} elem\n\t */\n\tstatic _onCopyValue(ev, elem) {\n\t\tconst path = elem.closest('[data-path]').dataset.path;\n\t\tif (!path) {\n\t\t\tui.notifications.error('Failed to parse data path.');\n\t\t\treturn void console.error('Failed to parse path from', { path, element: this });\n\t\t}\n\n\t\t// Reconstruct data path so it can be retrieved\n\t\tconst { path: root, data } = this.getDataVariant(this.object);\n\t\tconst copyData = root ? {} : data;\n\t\tif (root) foundry.utils.setProperty(copyData, root, data);\n\n\t\t// Retrieve data\n\t\tconst original = fu.getProperty(copyData, path);\n\t\t// Make clipboard safe copy of data\n\t\tconst value = getSafeCopy(original);\n\t\tconst jsonString = JSON.stringify(value, null, 2);\n\n\t\tconsole.log(`Saving value of %c${path}%c to clipboard:`, CFG.COLORS.id, CFG.COLORS.unset, { value: jsonString });\n\n\t\tgame.clipboard.copyPlainText(jsonString)\n\t\t\t.then(() => ui.notifications.info(game.i18n.format('DataInspector.Info.CopyValue', { path })));\n\t}\n\n\t_syncPartState(partId, newEl, oldEl, state) {\n\t\t// TODO: Save expanded state here\n\t\tif (partId === 'form') this._syncMainPart(newEl);\n\n\t\treturn super._syncPartState(partId, newEl, oldEl, state);\n\t}\n\n\t_syncMainPart(html) {\n\t\t// Open previously open paths\n\t\tfor (const el of html.querySelectorAll('[data-path]')) {\n\t\t\tconst path = el.dataset.path;\n\t\t\tif (this._expandedItems.has(path))\n\t\t\t\tthis._expandDataEl(el);\n\t\t}\n\t}\n\n\t_onRender(context, options) {\n\t\tsuper._onRender(context, options);\n\n\t\tconst html = this.element.querySelector('.window-content');\n\n\t\tconst header = html.querySelector('header');\n\n\t\tconst appEl = html.closest('[data-appid]');\n\t\tif (appEl) {\n\t\t\tconst doc = this.document;\n\t\t\tconst item = doc instanceof Item ? doc : null;\n\t\t\tif (item) {\n\t\t\t\tappEl.dataset.itemId = item.id;\n\t\t\t\tappEl.dataset.itemUuid = item.uuid;\n\t\t\t}\n\n\t\t\tconst actor = doc instanceof Actor ? doc : doc.parent;\n\t\t\tif (actor) {\n\t\t\t\tappEl.dataset.actorId = actor.id;\n\t\t\t\tappEl.dataset.actorUuid = actor.uuid;\n\t\t\t}\n\t\t}\n\n\t\tconst app = this;\n\t\tconst dataSection = html.querySelector('.datatree > .dataview');\n\t\tdataSection.addEventListener('dblclick', function openEditor(ev) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\n\t\t\tif (DataBrowser.EDITABLE_MODES.includes(app._mode)) {\n\t\t\t\tconst el = ev.target;\n\t\t\t\tconst ael = el.dataset.path ? el : el.closest('[data-path]');\n\t\t\t\tif (ael) app._openValueEditor(ev, ael.dataset.path);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tui.notifications.warn(`Editing not supported in \"${app._mode}\" mode!`);\n\t\t\t}\n\t\t});\n\n\t\tconst events = {\n\t\t\tcopy: {\n\t\t\t\tpath: this.constructor._onCopyPath.bind(this),\n\t\t\t\tvalue: this.constructor._onCopyValue.bind(this),\n\t\t\t},\n\t\t};\n\n\t\tdataSection.addEventListener('contextmenu', function copyData(ev) {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\n\t\t\tconst elem = ev.target.closest('[data-copy]');\n\t\t\tevents.copy[elem?.dataset.copy]?.(ev, elem);\n\t\t});\n\n\t\t/**\n\t\t * @param {Element} el\n\t\t */\n\t\tconst buildSearchCache = (el) => {\n\t\t\tconst path = el.dataset.path;\n\t\t\tconst key = el.dataset.key;\n\t\t\tconst label = el.querySelector('label.key');\n\t\t\tthis.paths.set(path, {\n\t\t\t\tpath,\n\t\t\t\tkey,\n\t\t\t\telement: el,\n\t\t\t\tlabel: label.textContent,\n\t\t\t});\n\t\t};\n\n\t\tconst useTooltips = game.settings.get(CFG.id, CFG.SETTINGS.tooltip);\n\n\t\tconst paths = dataSection.querySelectorAll('li[data-path]');\n\t\tconst pathPrefix = this._mode === 'rolldata' ? '@' : '';\n\t\tpaths.forEach(el => {\n\t\t\tif (!useTooltips) return;\n\t\t\tconst dEl = el.querySelector('.details');\n\t\t\tdEl?.addEventListener('mouseenter', async ev => {\n\t\t\t\tconst path = el.dataset.path;\n\n\t\t\t\tlet dpath = path;\n\t\t\t\tif (app._mode !== 'rolldata') {\n\t\t\t\t\tconst parts = path.split('.');\n\n\t\t\t\t\t// Pop root\n\t\t\t\t\tif (this.options.root)\n\t\t\t\t\t\tparts.shift();\n\n\t\t\t\t\tdpath = parts.join('.');\n\t\t\t\t}\n\n\t\t\t\tconst dd = this.root?.getAtPath(dpath);\n\t\t\t\tconst typeId = dd.typeId;\n\t\t\t\tconst typeName = typeId !== DATA_TYPES.custom ? game.i18n.localize(`DataInspector.Types.${DATA_TYPE_INVERTED[typeId]}`) : dd.className;\n\n\t\t\t\tconst isFlags = dd.treetype === 'flags';\n\n\t\t\t\tconst templateData = {\n\t\t\t\t\tdd,\n\t\t\t\t\tpath: pathPrefix + path,\n\t\t\t\t\ttype: typeName,\n\t\t\t\t\tdocumentId: dd.documentId,\n\t\t\t\t\tisContainer: (dd.isContainer || dd.isDocument),\n\t\t\t\t\tchildren: (dd.isContainer || dd.isDocument) ? dd.children.length : null,\n\t\t\t\t\tisString: dd.isString,\n\t\t\t\t\tlength: dd.isString ? dd.value.length : null,\n\t\t\t\t\ttreetype: dd.treetype,\n\t\t\t\t\tnotFlags: !isFlags,\n\t\t\t\t\tinData: {\n\t\t\t\t\t\trolldata: {\n\t\t\t\t\t\t\tshow: !isFlags && dd.treetype !== 'rolldata',\n\t\t\t\t\t\t\tlabel: 'DataInspector.Data.Roll',\n\t\t\t\t\t\t\tpresent: !isFlags ? dd.inRollData : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tderived: {\n\t\t\t\t\t\t\tshow: !isFlags && dd.treetype !== 'derived',\n\t\t\t\t\t\t\tlabel: 'DataInspector.Data.Derived',\n\t\t\t\t\t\t\tpresent: !isFlags ? dd.inDerivedData : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\tshow: !isFlags && dd.treetype !== 'source',\n\t\t\t\t\t\t\tlabel: 'DataInspector.Data.Source',\n\t\t\t\t\t\t\tpresent: !isFlags ? dd.inSourceData : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttemporary: {\n\t\t\t\t\t\t\tshow: dd.treetype === 'source',\n\t\t\t\t\t\t\tlabel: 'DataInspector.Data.Temporary',\n\t\t\t\t\t\t\tpresent: !isFlags ? dd.inTemporaryData : false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst div = document.createElement('div');\n\n\t\t\t\t/* global renderTemplate */\n\t\t\t\tconst rt = foundry.utils.renderTemplate ?? renderTemplate; // v12 doesn't yet have foundry.utils.renderTemplate\n\n\t\t\t\tdiv.innerHTML = await rt(`modules/${CFG.id}/template/tooltip.hbs`, templateData);\n\n\t\t\t\tgame.tooltip.activate(dEl, { content: div, direction: 'UP', cssClass: 'data-inspector' });\n\t\t\t}, { passive: true });\n\n\t\t\tdEl?.addEventListener('mouseleave', () => game.tooltip.deactivate(), { passive: true });\n\t\t});\n\n\t\tconst search = header.querySelector('input.search');\n\t\tsearch.addEventListener('change', ev => this.debounceSearch(ev.target.value, ev, false), { passive: true });\n\t\tsearch.addEventListener('input', ev => this.debounceSearch(ev.target.value, ev, true), { passive: true });\n\n\t\tthis.paths = new Collection();\n\t\tpaths.forEach(el => buildSearchCache(el));\n\n\t\t/*\n\tconst sEnd = header.querySelector('input.search-end');\n\tsEnd.addEventListener('change', ev => {\n\t\tthis._searchEnd = ev.target.checked;\n\t\tthis.debounceSearch(this._search);\n\t});\n\t*/\n\n\t\tconst functions = header.querySelector('input.functions');\n\t\tfunctions.addEventListener('change', ev => {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\n\t\t\tthis._functions = ev.target.checked;\n\t\t\tthis.render();\n\t\t});\n\n\t\t/*\n\tconst indocument = header.querySelector('input.document');\n\tindocument.addEventListener('change', ev => {\n\t\tthis._document = ev.target.checked;\n\t\tthis.render();\n\t});\n\t*/\n\n\t\tif (this._search.length) this.debounceSearch(this._search);\n\n\t\tif (this._functions) {\n\t\t\tif (!this._getGetterValueBound) this._getGetterValueBound = this._getGetterValue.bind(this);\n\t\t\tdataSection.addEventListener('click', function (ev) {\n\t\t\t\tif (!ev.target.matches('.getter.value')) return;\n\t\t\t\tev.preventDefault();\n\t\t\t\tev.stopPropagation();\n\t\t\t\tapp._getGetterValueBound(ev);\n\t\t\t});\n\t\t}\n\n\t\t// Always expand selected path\n\t\tthis.expandSelectedPath();\n\t}\n\n\t/**\n\t * @override\n\t * @param {object} config\n\t * @param {EVent} event\n\t */\n\t_onChangeForm(config, event) {\n\t\tsuper._onChangeForm(config, event);\n\n\t\tconst el = event.target;\n\n\t\tswitch (el.name) {\n\t\t\tcase 'mode':\n\t\t\t\tthis._onChangeDataSource(el.value, el, event);\n\t\t\t\tbreak;\n\t\t\tcase 'quality':\n\t\t\t\tthis._onChangeSearchQuality(el.valueAsNumber, el, event);\n\t\t\t\tbreak;\n\t\t\tcase 'path':\n\t\t\t\tthis._debounceCustomPath(el.value, event, true);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onChangeSearchQuality(quality, el, ev) {\n\t\tthis._resultQuality = quality;\n\t\tif (this._search.length > 0) this.doSearch(this._search, { forceRefresh: true });\n\t}\n\n\t/**\n\t * @param {string} mode\n\t * @param {HTMLElement} el\n\t * @param {Event} event\n\t */\n\t_onChangeDataSource(mode, el, event) {\n\t\tconsole.log('Mode Change:', this._mode, '->', mode);\n\t\tif (this._mode === mode) return;\n\n\t\t// Convert path to new mode\n\t\tconst path = this._path;\n\t\tif (path.length > 0) {\n\t\t\tconst pathp = path.split('');\n\t\t\tconst root = this.options.root ?? null;\n\t\t\tlet prefix;\n\t\t\tif (root) prefix = `${root}.`;\n\t\t\tif (path[0] === '@' && this._mode === 'rolldata')\n\t\t\t\tpathp.splice(0, 1, prefix);\n\t\t\telse if (path.length > 5 && path.startsWith(prefix) && mode === 'rolldata')\n\t\t\t\tpathp.splice(0, prefix.length, '@');\n\t\t\tthis._path = pathp.join('');\n\t\t}\n\n\t\t// Swap mode\n\t\tthis._path = this.getBasePath(this._path, this._mode);\n\t\tthis._mode = mode;\n\t\tthis._lastSearch = undefined;\n\n\t\tthis.render({ keepCache: true });\n\t}\n\n\t/**\n\t * @param {Event} event\n\t * @param {string} path\n\t */\n\t_openValueEditor(event, path) {\n\t\tif (!game.settings.get(CFG.id, CFG.SETTINGS.allowEditing))\n\t\t\treturn ui.notifications.warn('Editing has been disabled.');\n\n\t\tconst pp = path.split('.');\n\t\tconst doc = this.document;\n\t\tlet currentData = doc;\n\n\t\tlet type;\n\t\tlet inArray = false;\n\t\twhile (pp.length > 0) {\n\t\t\tconst part = pp.shift();\n\t\t\ttype = getChildTypeId(currentData, part);\n\t\t\tif (type === DATA_TYPES.getter) return ui.notifications.error(game.i18n.localize('DataInspector.Error.NoGetterEdit'));\n\n\t\t\tcurrentData = currentData[part];\n\t\t\tif (currentData == null && pp.length > 0)\n\t\t\t\treturn ui.notifications.warn(game.i18n.format('DataInspector.Error.NavigationFailure', { path }));\n\t\t\tif (Array.isArray(currentData) && pp.length > 0) {\n\t\t\t\tinArray = true;\n\t\t\t\t// return ui.notifications.warn(`Editing arrays or values inside of arrays not supported: ${path}`);\n\t\t\t}\n\t\t}\n\n\t\tconst isSupported = DataEditor.supportedTypes.includes(type);\n\t\tif (!isSupported) {\n\t\t\tconst allowUnsupported = game.settings.get(CFG.id, CFG.SETTINGS.allowEditingUnsupported);\n\t\t\tif (!allowUnsupported)\n\t\t\t\treturn ui.notifications.warn(game.i18n.format('DataInspector.Error.UnsupportedEditType', { type: DATA_TYPE_INVERTED[type] }));\n\t\t}\n\n\t\tnew DataEditor({ document: this.document, path, type, isToken: this._mode === 'override', inArray })\n\t\t\t.render({ force: true, focus: true });\n\t}\n\n\t/**\n\t * @param {Event} _event\n\t */\n\t_copyId(_event) {\n\t\tconst id = this.dataset.id;\n\t\tconsole.log('Copying ID:', id);\n\t\treturn game.clipboard.copyPlainText(id);\n\t}\n\n\t_getGetterValueBound;\n\n\t/**\n\t * @param {Event} event\n\t */\n\t_getGetterValue(event) {\n\t\tevent.stopImmediatePropagation();\n\t\tevent.preventDefault();\n\t\tconst target = event.target;\n\t\tif (!target) return;\n\t\ttarget.removeEventListener('click', this._getGetterValueBound);\n\t\tthis._resolveGetter(target);\n\t}\n\n\t/**\n\t * @param {Element} element\n\t */\n\t_resolveGetter(element) {\n\t\tconst el = element.dataset.path ? element : element.closest('[data-path]');\n\t\tif (!el) return;\n\t\t/** @type {string} */\n\t\tconst path = el.dataset.path;\n\n\t\tconst ds = this.root.getAtPath(path);\n\t\tconst value = ds.value;\n\t\tds.typeId = getTypeId(value); // Make sure tooltips detect correct type\n\n\t\telement.textContent = value;\n\t\telement.classList.add('resolved');\n\t\telement.classList.add(ds.type);\n\t}\n\n\t/**\n\t * Strip @ and data. prefix\n\t *\n\t * @param {string} path\n\t * @param {\"rolldata\"|\"source\"|\"derived\"|\"override\"} oldMode\n\t * @param {\"rolldata\"|\"source\"|\"derived\"|\"override\"} targetMode\n\t * @returns {string}\n\t */\n\tgetBasePath(path, oldMode, targetMode) {\n\t\toldMode ??= this._mode;\n\t\tif (oldMode === 'rolldata')\n\t\t\treturn path.replace(/^@/, '');\n\t\tif (targetMode === 'rolldata')\n\t\t\treturn path.replace(/^system\\./, '@');\n\t\treturn path;\n\t}\n\n\texpandSelectedPath() {\n\t\tif (this._path.length == 0) return;\n\n\t\tconst path = this.getBasePath(this._path);\n\n\t\t// console.log({ path, source: this._path, mode: this._mode });\n\t\tconst p = this.paths.get(path);\n\t\tif (p) {\n\t\t\tthis._expandDataElTree(p.element);\n\t\t\tthis._pathEl = p.element;\n\t\t\tthis._highlightEl(this._pathEl, true);\n\t\t\tthis._pathEl.scrollIntoView({ block: 'center' });\n\t\t}\n\t}\n\n\tstatic INPUT_DELAY = 250;\n\tstatic INPUT_MAX_DELAY = 500;\n\n\tsearchDelayTimer;\n\tselectDelayTimer;\n\n\t/**\n\t * @param {string} search\n\t * @param {Event} event\n\t * @param {boolean} active\n\t */\n\tdebounceSearch(search, event, active = false) {\n\t\tclearTimeout(this.searchDelayTimer);\n\t\t// Increase delay for short queries and shorten it for end of input\n\t\tif (search.length === 0) active = false;\n\t\tconst iDelay = this.constructor.INPUT_DELAY;\n\t\tconst iMaxDelay = this.constructor.INPUT_MAX_DELAY;\n\t\tconst delay = Math.clamp(active ? search.length > 3 ? iDelay : iDelay * 2 : iDelay / 2, 100, iMaxDelay);\n\t\tthis.searchDelayTimer = setTimeout(_ => this.doSearch(search), delay);\n\t}\n\n\t/**\n\t * @param {string} input\n\t * @param {Event} event\n\t * @param {boolean} active\n\t */\n\t_debounceCustomPath(input, event, active = false) {\n\t\tthis._path = input;\n\t\tif (this._pathEl) {\n\t\t\tthis._pathEl.classList.toggle('selected', false);\n\t\t\tthis._pathEl = null;\n\t\t}\n\t\tclearTimeout(this.selectDelayTimer);\n\t\tif (input.length === 0) active = false;\n\t\tconst iDelay = this.constructor.INPUT_DELAY;\n\t\tconst iMaxDelay = this.constructor.INPUT_MAX_DELAY;\n\t\tconst delay = Math.clamp(active ? input.length > 3 ? iDelay : iDelay * 2 : iDelay / 2, 100, iMaxDelay);\n\t\t// console.log('SelectDebounce:', search, delay);\n\t\tthis.selectDelayTimer = setTimeout(_ => this.selectCustomPath(input), delay);\n\t}\n\n\t/**\n\t * @param {string} input\n\t */\n\tselectCustomPath(input) {\n\t\tthis._path = input;\n\t\tthis.expandSelectedPath();\n\t\tconst path = this.paths.get(input);\n\t\t// console.log('SELECTING:', input, path);\n\t\tif (path) {\n\t\t\tthis._expandDataElTree(path.element);\n\t\t\tthis._highlightEl(path.element);\n\t\t\tthis._pathEl = path.element;\n\t\t}\n\t\telse {\n\t\t\tthis._pathEl = null;\n\t\t}\n\t}\n\n\t_lastSearch;\n\tlastEndSerch;\n\t/**\n\t * @param {string} search\n\t * @param {object} options\n\t * @param {boolean} options.forceRefresh\n\t */\n\tdoSearch(search, { forceRefresh = false } = {}) {\n\t\tthis._search = search;\n\t\tconsole.log('Searching:', this._search);\n\n\t\tif (forceRefresh !== true && this._lastSearch === search && this.lastEndSerch === this._searchEnd) return;\n\n\t\tthis._lastSearch = search;\n\t\tthis.lastEndSerch = this._searchEnd;\n\n\t\tif (search.length == 0) {\n\t\t\tthis.paths.forEach(p => this.collapseAndClearEl(p.element, false));\n\t\t\tthis.expandSelectedPath();\n\t\t\treturn;\n\t\t}\n\n\t\t// console.log('DATA INSPECTOR |', Date.now(), 'Searching:', search, 'EndFocus:', this._searchEnd);\n\n\t\t// Collapse all first to ensure expansion happens smoothly\n\t\tthis.paths.forEach(p => this.collapseAndClearEl(p.element, true));\n\n\t\tconst term = search.toLowerCase().split('');\n\n\t\t/**\n\t\t * Do actual search\n\t\t *\n\t\t * @param {string} term\n\t\t * @param {string} subject\n\t\t * @param {object} options\n\t\t * @param {boolean} options.harsh\n\t\t */\n\t\tfunction matchTerm(term, subject, { harsh = true } = {}) {\n\t\t\tconst indexes = [];\n\t\t\tconst subjectParts = subject.toLowerCase().split('');\n\t\t\tlet consecutives = 0, longestChain = 0;\n\t\t\tlet si = 0, sm = term[0], lastMatch = -2;\n\t\t\tlet lastChain = 1;\n\t\t\tconst scoring = [];\n\t\t\tconst updateLongestChain = () => {\n\t\t\t\tif (lastChain > longestChain) longestChain = lastChain;\n\t\t\t\tlastChain = 1;\n\t\t\t};\n\t\t\tfor (let i = 0; i < subjectParts.length; i++) {\n\t\t\t\tif (subjectParts[i] === sm) {\n\t\t\t\t\tindexes.push(i);\n\t\t\t\t\t// Give score for subsequent matches\n\t\t\t\t\tif (lastMatch === i - 1) {\n\t\t\t\t\t\tscoring.push(new Score(3, `Consecutive [${i}]: +3`));\n\t\t\t\t\t\tconsecutives++;\n\t\t\t\t\t\tlastChain++;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tscoring.push(new Score(1, `Match [${i}]: +1`));\n\t\t\t\t\t\tupdateLongestChain();\n\t\t\t\t\t}\n\t\t\t\t\tlastMatch = i;\n\t\t\t\t\t// Add score if match is closer to the end\n\t\t\t\t\tconst endBonus = Math.clamp(Math.round((subjectParts.length - i) / 5), 0, 3);\n\t\t\t\t\tif (endBonus > 0) scoring.push(new Score(endBonus, `End bonus: +${endBonus}`));\n\t\t\t\t\t// End when there's nothing left to search\n\t\t\t\t\tsm = term[++si];\n\t\t\t\t\tif (sm === undefined) break;\n\t\t\t\t}\n\t\t\t}\n\t\t\tupdateLongestChain();\n\n\t\t\t// Basic score for matched letters\n\t\t\tif (indexes.length > 0) scoring.push(new Score(indexes.length * 3, `Matched letters bonus: ${indexes.length * 3}`));\n\t\t\telse scoring.push(new Score(-100, 'No matches: -100'));\n\n\t\t\t// Offset less accurate matches\n\t\t\t/*\n\t\tscore -= subjectParts.length;\n\t\tscoring.push(`Accuracy penalty: -${subjectParts.length}`);\n\t\t*/\n\n\t\t\t// Search term found fully\n\t\t\tconst full = indexes.length == term.length;\n\t\t\tif (full) scoring.push(new Score(20, 'Full match: +20'));\n\n\t\t\t// Reduce score of search terms that are matched only partially\n\t\t\tconst half = indexes.length < Math.floor(term.length / 2) - 2;\n\t\t\tif (harsh) {\n\t\t\t\tconst cumulative = scoring.reduce((prev, cur) => cur.value + prev),\n\t\t\t\t\thalfScore = -Math.floor(cumulative / 2);\n\t\t\t\tif (half) scoring.push(new Score(halfScore, `Partial match: ${halfScore}`));\n\t\t\t\tif (longestChain <= 1) scoring.push(new Score(-20, 'Short chains: -20'));\n\t\t\t}\n\n\t\t\treturn new TermMatch({ indexes, full, half, ratio: (consecutives + 1) / term.length, consecutives, longestChain, scoring });\n\t\t}\n\n\t\tlet fullMatches0 = 0, fullMatches1 = 0;\n\n\t\t// Extremely simple search\n\t\t// TODO: Allow skipping letters in search term but impose negative score if that is the only way to get them to match.\n\t\tconst results = this.paths.reduce((results, target) => {\n\t\t\tconst matchPath = matchTerm(term, target.path),\n\t\t\t\tmatchKey = matchTerm(term, target.key);\n\n\t\t\tif (matchKey.full) fullMatches0++;\n\t\t\tif (matchPath.full) fullMatches1++;\n\n\t\t\tlet match = matchPath.ratio > 0.5,\n\t\t\t\tratio = matchPath.ratio;\n\n\t\t\tif (this._keyFocus) {\n\t\t\t\tmatchPath.score /= 5;\n\t\t\t\tratio = matchKey.ratio;\n\t\t\t\tmatch = matchKey.ratio > matchPath.ratio;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tratio += matchKey.ratio * 2;\n\t\t\t\tratio /= 3;\n\t\t\t}\n\n\t\t\tresults.push(new SearchResult({\n\t\t\t\tpath: target.path,\n\t\t\t\tmatch,\n\t\t\t\ttarget,\n\t\t\t\tkeyFocus: this._keyFocus,\n\t\t\t\tscore: matchPath.score / 2 + matchKey.score * 2,\n\t\t\t\tkeyFullMatch: matchKey.full,\n\t\t\t\tpathFullMatch: matchPath.full,\n\t\t\t\tpathIndexes: matchPath.indexes,\n\t\t\t\tkeyIndexes: matchKey.indexes,\n\t\t\t\tratio,\n\t\t\t\tscoring: { full: matchPath.scoring, key: matchKey.scoring },\n\t\t\t}));\n\n\t\t\treturn results;\n\t\t}, []);\n\n\t\tresults.sort((a, b) => {\n\t\t\tif (a.full && !b.full) return -1;\n\t\t\tif (b.full && !a.full) return 1;\n\t\t\treturn b.score - a.score;\n\t\t});\n\n\t\tconst Break = {};\n\n\t\t// Format results\n\t\ttry {\n\t\t\tresults.forEach((r) => {\n\t\t\t\tconst el = r.target.element;\n\t\t\t\tel.dataset.searchScore = `${r.score}`;\n\t\t\t\tel.dataset.searchRatio = `${r.ratio}`;\n\n\t\t\t\tlet q = 'decent';\n\t\t\t\tif (r.mismatch) q = 'mismatch';\n\t\t\t\telse if (r.bad) q = 'bad';\n\t\t\t\telse if (r.good) q = 'good';\n\t\t\t\tel.dataset.matchQuality = q;\n\n\t\t\t\tif (fullMatches0 > 0) {\n\t\t\t\t\tif (r.ratio > this._resultQuality) this._expandDataElTree(el);\n\t\t\t\t}\n\t\t\t\telse if (!r.bad)\n\t\t\t\t\tthis._expandDataElTree(el);\n\n\t\t\t\t// if (!r.mismatch) console.log(r.path, { score: r.score }, { r, quality: el.dataset.matchQuality });\n\n\t\t\t\t// if (index > 20) throw Break;\n\t\t\t});\n\t\t}\n\t\tcatch (err) {\n\t\t\tif (err !== Break) throw err;\n\t\t}\n\n\t\tthis.expandSelectedPath();\n\t}\n\n\trender(options = {}) {\n\t\tif (options.action === 'update') options.keepCache = false;\n\t\tif (options.keepCache !== true) {\n\t\t\tthis._currentData = undefined;\n\t\t\tthis._rollData = undefined;\n\t\t\tthis._sourceData = undefined;\n\t\t\tthis._derivedData = undefined;\n\t\t\tthis._overrides = undefined;\n\t\t\tthis._flagData = undefined;\n\t\t\tthis._lastSearch = undefined;\n\t\t}\n\n\t\treturn super.render(options);\n\t}\n\n\t_onFirstRender(context, options) {\n\t\tsuper._onFirstRender(context, options);\n\n\t\tif (this.document) {\n\t\t\tthis.document.apps[this.id] = this;\n\t\t}\n\t}\n\n\tasync _preClose(options) {\n\t\tawait super._preClose(options);\n\n\t\tif (this.document) {\n\t\t\tdelete this.document.apps[this.id];\n\t\t}\n\t}\n}\n",
    "import { CFG } from './config.mjs';\nimport { DataBrowser } from './data-browser.mjs';\n\nconst refreshActiveDialogs = () => Object.values(ui.windows)\n\t.forEach(app => app instanceof DataBrowser ? app.render() : null);\n\nHooks.once('init', function registerSettings() {\n\tgame.settings.register(CFG.id, CFG.SETTINGS.mode, {\n\t\tname: 'DataInspector.Settings.DefaultMode',\n\t\thint: 'DataInspector.Settings.DefaultModeHint',\n\t\tscope: 'client',\n\t\tconfig: true,\n\t\ttype: String,\n\t\tdefault: 'rolldata',\n\t\tchoices: {\n\t\t\trolldata: 'DataInspector.Data.Roll',\n\t\t\tsource: 'DataInspector.Data.Source',\n\t\t\tderived: 'DataInspector.Data.Derived',\n\t\t\tflags: 'DataInspector.Data.Flags',\n\t\t},\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.results, {\n\t\tname: 'DataInspector.Settings.ResultQuality',\n\t\thint: 'DataInspector.Settings.ResultQualityHint',\n\t\tscope: 'client',\n\t\tconfig: true,\n\t\ttype: Number,\n\t\tdefault: 0.7,\n\t\trange: { min: 0.0, max: 1.0, step: 0.01 },\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.functions, {\n\t\tname: 'DataInspector.Settings.IncludeFunctions',\n\t\thint: 'DataInspector.Settings.IncludeFunctionsHint',\n\t\tscope: 'client',\n\t\tconfig: true,\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.allowEditing, {\n\t\tname: 'DataInspector.Settings.AllowEditing',\n\t\thint: 'DataInspector.Settings.AllowEditingHint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.allowEditingUnsupported, {\n\t\tname: 'DataInspector.Settings.AllowEditingUnsupported',\n\t\thint: 'DataInspector.Settings.AllowEditingUnsupportedHint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.allowUsers, {\n\t\tname: 'DataInspector.Settings.AllowUsers',\n\t\thint: 'DataInspector.Settings.AllowUsersHint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t});\n\n\tgame.settings.register(CFG.id, CFG.SETTINGS.tooltip, {\n\t\tname: 'DataInspector.Settings.Tooltip',\n\t\thint: 'DataInspector.Settings.TooltipHint',\n\t\tconfig: true,\n\t\tscope: 'client',\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t\tonChange: () => refreshActiveDialogs(),\n\t});\n});\n",
    "import { CFG } from './config.mjs';\nimport { DataBrowser } from './data-browser.mjs';\nimport { DataEditor } from './data-editor.mjs';\n\n/**\n * @param {Actor|Item|object} options\n */\nfunction openInspector(options = {}) {\n\tif (options instanceof foundry.abstract.DataModel) options = { document: options };\n\toptions.object ??= options.document;\n\n\tlet app = [...foundry.applications.instances].find(app => app.object === options.object);\n\tapp ??= new DataBrowser(options);\n\n\tapp.render({ render: true, force: true });\n};\n\nfunction injectHeaderDataButton(sheet, buttons) {\n\tconst allowUsers = game.settings.get(CFG.id, CFG.SETTINGS.allowUsers);\n\tif (!allowUsers && !game.user.isGM) return;\n\n\t// Exhaustive document lookup\n\tconst document = sheet.document ?? sheet.actor ?? sheet.item ?? sheet.object;\n\tif (!(document instanceof foundry.abstract.Document)) throw new Error('Could not locate sheet\\'s document');\n\n\tbuttons.unshift({\n\t\tclass: 'data-inspector',\n\t\ticon: 'fa-solid fa-atom',\n\t\tlabel: game.i18n.localize('DataInspector.DataButton'),\n\t\tonclick: _ => openInspector(document),\n\t});\n};\n\n/**\n * @param {foundry.applications.api.ApplicationV2} app\n * @param {object[]} entries\n */\nfunction injectContextDataButton(app, entries) {\n\tlet collection = app.collection ?? game.packs.get(packId);\n\n\t/* global DocumentCollection */\n\tif (!(collection instanceof DocumentCollection)) collection = collection.collection;\n\tif (!collection) return;\n\n\tconst packId = collection.metadata?.id;\n\n\tconst documentType = collection.documentName;\n\tif (!['Item', 'Actor'].includes(documentType)) return;\n\n\tentries.push({\n\t\tname: 'DataInspector.Context.OpenInspector',\n\t\ticon: '<i class=\"fa-solid fa-atom\"></i>',\n\t\tcondition: () => {\n\t\t\tconst allowUsers = game.settings.get(CFG.id, CFG.SETTINGS.allowUsers);\n\t\t\treturn allowUsers || game.user.isGM;\n\t\t},\n\t\tcallback: async (entry) => {\n\t\t\tif (entry instanceof jQuery) entry = entry[0];// v12/v13 cross-compatibility\n\t\t\tconst documentId = entry.dataset.entryId || entry.dataset.documentId;\n\n\t\t\tlet doc;\n\t\t\tif (packId)\n\t\t\t\tdoc = await collection.getDocument(documentId);\n\t\t\telse\n\t\t\t\tdoc = collection.get(documentId);\n\n\t\t\tif (doc)\n\t\t\t\topenInspector(doc);\n\t\t\telse\n\t\t\t\tconsole.warn('Document not found:', { documentId, packId, id: app.id });\n\t\t},\n\t});\n};\n\nHooks.once('ready', async () => {\n\tconst C = CFG.COLORS;\n\n\tconst allowUsers = game.settings.get(CFG.id, CFG.SETTINGS.allowUsers);\n\tif (!allowUsers && !game.user.isGM)\n\t\treturn void console.log(`%cDATA INSPECTOR%c ðŸ” | %c${mod.version}%c | User access blocked in settings.`, C.main, C.unset, C.id, C.unset);\n\n\t// Register API\n\tconst mod = game.modules.get(CFG.id);\n\tmod.api = {\n\t\tinspect: openInspector,\n\t\tapplications: {\n\t\t\tbrowser: DataBrowser,\n\t\t\teditor: DataEditor,\n\t\t},\n\t\thandlers: {\n\t\t\tapplications: {\n\t\t\t\trender: injectAppHeaderDataButton,\n\t\t\t},\n\t\t},\n\t};\n\n\t// Fetch in-built system specific extensions\n\t// const systemExtPath = `modules/${CFG.module}/systems/${game.system.id}.mjs`;\n\n\tif (['pf1'].includes(game.system.id)) { // Temporary limiter on import() errors\n\t\tawait import(`./systems/${game.system.id}.mjs`)\n\t\t\t.then(() => console.log('%cDATA INSPECTOR%c ðŸ” | System extensions loaded %câœ”', C.main, C.unset, 'color:green'))\n\t\t\t.catch(() => console.log('%cDATA INSPECTOR%c ðŸ” | System extensions not found %câœ˜', C.main, C.unset, 'color:red'));\n\t}\n\n\tconsole.log(`%cDATA INSPECTOR%c ðŸ” | %c${mod.version}%c | READY`, C.main, C.unset, C.id, C.unset);\n\n\tHooks.callAll('data-inspector.appHandler', mod.api.handlers.applications.render);\n});\n\n/**\n *\n * @param {*} app - Application\n * @param {Function<Application|ApplicationV2>} getObject\n * @param strict\n */\nfunction injectAppHeaderDataButton(app, getObject, strict = false) {\n\tlet html = app.element;\n\tif (html instanceof jQuery) html = html[0];\n\n\t// Exhaustive document lookup\n\tlet object;\n\tif (getObject) {\n\t\tobject = getObject(app);\n\t\tobject.title ??= () => object.name ?? object.title ?? object.label;\n\t}\n\telse {\n\t\tobject = app.document ?? app.object ?? app.actor ?? app.item;\n\t}\n\n\tif (app instanceof foundry.applications.api.ApplicationV2)\n\t\tinjectAppHeaderDataButtonAppV2(app, html, object, strict);\n\telse\n\t\tinjectAppHeaderDataButtonAppV1(app, html, object, strict);\n}\n\nfunction injectAppHeaderDataButtonAppV2(app, html, target, strict = false) {\n\tconst header = html.querySelector('header.window-header');\n\tif (!header) return;\n\tif (header.querySelector('button[data-action=\"__mdiInspectData\"]')) return; // Already there\n\tconst rel = header.querySelector('button[data-action=\"copyUuid\"]');\n\tif (!rel) return; // Didn't find copy UUID button\n\n\tconst b = document.createElement('button');\n\tb.type = 'button';\n\tb.dataset.action = '__mdiInspectData';\n\tb.dataset.tooltip = game.i18n.localize('DataInspector.Context.OpenInspector');\n\tb.classList.add('header-control', 'fa-solid', 'fa-atom', 'data-inspector', 'icon');\n\trel.before(b);\n\n\tapp.options.actions.__mdiInspectData ??= function (_event, _el) {\n\t\topenInspector(target);\n\t};\n}\n\nfunction injectAppHeaderDataButtonAppV1(app, html, target, strict = false) {\n\tconst header = html.querySelector('header.window-header');\n\tif (!header) return;\n\n\tif (header.querySelector('a.data-inspector.control.icon')) return; // Already there\n\tconst close = header.querySelector('.header-button.control.close');\n\tconst title = !close ? header.querySelector('.window-title') : null;\n\tif (!close && !title) return; // Didn't find copy UUID button\n\n\tconst allowUsers = game.settings.get(CFG.id, CFG.SETTINGS.allowUsers);\n\tif (!allowUsers && !game.user.isGM) return;\n\n\tconst b = document.createElement('a');\n\tb.dataset.tooltip = game.i18n.localize('DataInspector.Context.OpenInspector');\n\tb.classList.add('header-button', 'control', 'data-inspector', 'icon');\n\tconst i = document.createElement('i');\n\ti.classList.add('fa-solid', 'fa-atom', 'fa-fw');\n\ti.inert = true;\n\tb.append(i, ' ', game.i18n.localize('DataInspector.DataButton'));\n\n\t// setTimeout() just to fight Foundry on click handlin priority\n\tsetTimeout(() => {\n\t\tb.addEventListener('click', (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tevent.stopImmediatePropagation();\n\n\t\t\topenInspector(target);\n\t\t});\n\t},\n\t// Foundry waits 500, we wait just a tiny bit longer. Sadly not a const or anything so if they change this, it'll suck\n\t510);\n\n\tif (close) close.before(b);\n\telse if (title) title.after(b);\n}\n\n/**\n * HACK for Foundry v12\n *\n * @param {ApplicationV2} app\n * @param {HTMLElement} el\n */\nfunction injectDocumentSheetHeaderDataButtonV2(app, el) {\n\tif (app instanceof DataBrowser || app instanceof DataEditor) return;\n\n\tconst doc = app.document;\n\tif (!(doc instanceof Actor || doc instanceof Item)) return;\n\tif (!doc?.testUserPermission?.(game.user, 'OBSERVER')) return;\n\n\tinjectAppHeaderDataButton(app, undefined, true);\n}\n\nHooks.on('renderDocumentSheetV2', injectDocumentSheetHeaderDataButtonV2);\n\n// Header buttons\nHooks.on('getActorSheetHeaderButtons', injectHeaderDataButton); // v12 and prior\nHooks.on('getItemSheetHeaderButtons', injectHeaderDataButton); // v12 and prior\n\n// Context menus\nHooks.on('getItemDirectoryEntryContext', injectContextDataButton); // v12 and prior\nHooks.on('getItemContextOptions', injectContextDataButton); // v13\nHooks.on('getActorDirectoryEntryContext', injectContextDataButton); // v12 and prior\nHooks.on('getActorContextOptions', injectContextDataButton); // v13\nHooks.on('getCompendiumEntryContext', injectContextDataButton); // v12 and prior\nHooks.on('getCompendiumEntryContextOptions', injectContextDataButton); // v13\n"
  ],
  "mappings": "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",
  "debugId": "D264C91AC047CEF364756E2164756E21",
  "names": []
}